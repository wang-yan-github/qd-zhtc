import{f as e,b as a,q as l,r as t,M as n,o as i,h as o,i as r,k as s,l as d,m as c,t as u,I as p,w as m,c as h,p as g,O as f,F as b,j as _,L as v}from"./vendor.ac52fd94.js";import{_ as y,aL as V,a5 as w,aM as C,aN as k,aO as z,aP as x,aQ as P,aR as D}from"./index.1d57ac4a.js";const I={name:"xjczmana",data:()=>({tableH:0}),setup(){const t=e({areaId:"",nameOrPhone:"",receivePaperInvoice:"",pageIndex:1,pageSize:15}),n=a([]),i=a({}),o=a(0),r=()=>{V(t).then((e=>{n.value=e.data.list,o.value=e.data.total}))};r();const s=e({});w(s).then((e=>{p.areas=e.data}));const d=()=>{C(t).then((e=>{i.value=e.data}))};d();k().then((e=>{p.inspectManages=e.data}));const c=a(!1),u=a(!1);let p=e({time:"",areas:[],inspectManages:[]}),m=e({password:"",code:"",inspectId:"",rechargeAmount:""});const h=e=>`${e.getFullYear()}-${e.getMonth()+1>=10?e.getMonth()+1:"0"+(e.getMonth()+1)}-${e.getDate()>=10?e.getDate():"0"+e.getDate()}`;return{query:t,tableData:n,tableCountData:i,pageTotal:o,editVisible:c,patrolRechargeVisible:u,form:p,formPatrolRecharge:m,dialogT:"充值",getQueryDate:()=>{null==p.time||[]==p.time||""==p.time?(t.startTime="",t.endTime=""):(t.startTime=h(p.time[0]),t.endTime=h(p.time[1]))},handleSearch:()=>{t.pageIndex=1,r(),d()},handlePageChange:e=>{t.pageIndex=e,r(),d()},handleDelete:(e,a)=>{v.confirm("确定要删除吗？","提示",{type:"warning"}).then((()=>{z({PatrolRechargeManagementId:a.id}).then((()=>{})),l.success("删除成功"),r(),d(),n.value.splice(e,1)})).catch((()=>{}))},handleInvoiceReceiving:(e,a)=>{v.confirm("是否领取发票登记？","提示",{type:"warning"}).then((()=>{x({PatrolRechargeManagementId:a.id}).then((()=>{l.success("成功领取发票登记"),r(),d()}))})).catch((()=>{}))},handleEdit:(e,a,l)=>{l||Object.keys(p).forEach((e=>{p[e]=a[e]})),c.value=!0},saveEdit:()=>{m.password?P(m).then((e=>{1==e.data?(m.password="",m.code="",c.value=!1,u.value=!0,r(),d()):l.warning("充值密码不正确")})):l.warning("请输入充值密码")},savePatrolRecharge:()=>{m.inspectId&&m.rechargeAmount?D(m).then((e=>{m.inspectId="",m.rechargeAmount="",u.value=!1,r(),d()})):l.warning("请输入充值金额或巡检员")},multipleSelection:[],value:!0,activeName:"first"}},methods:{handleSelectionChange(e){this.selectedData=e},handleDeleteAll(){var e=this,a=this.selectedData;a?(a.forEach((function(a,l){e.tableData.forEach((function(l,t){a===l&&e.tableData.splice(t,1)}))})),l.success("删除成功"),this.$refs.multipleTable.clearSelection()):l.warning("请选择一条记录")}},created(){let e=document.documentElement.clientHeight||document.body.clientHeight;this.tableH=e-308+"px"}},R={class:"container"},S={class:"handle-box"},j={class:"left-panel"},q={class:"right-panel"},M=r("span",{class:"dispinline ml5"},null,-1),T=r("span",{class:"dispinline ml5 font14 color666"},"创建时间：",-1),E=r("span",{class:"dispinline ml5"},null,-1),U=r("span",{class:"dispinline ml5"},null,-1),A=r("div",{class:"clear"},null,-1),O={class:"pagination"},$={class:"dialog-footer"},H={class:"dialog-footer"};var Q=y(I,[["render",function(e,a,l,v,y,V){const w=t("el-button"),C=t("el-col"),k=t("el-row"),z=t("el-input"),x=t("el-option"),P=t("el-select"),D=t("el-date-picker"),I=t("el-table-column"),Q=t("el-table"),F=t("el-pagination"),L=t("el-form-item"),N=t("el-form"),K=t("el-dialog"),Y=n("permission");return i(),o("div",null,[r("div",R,[r("div",S,[r("div",j,[s(k,{class:""},{default:d((()=>[s(C,{span:24},{default:d((()=>[s(w,{size:"small",plain:"",type:"danger"},{default:d((()=>[c("充值人数(人)： "+u(v.tableCountData.recharge_pens),1)])),_:1}),s(w,{size:"small",plain:"",type:"danger"},{default:d((()=>[c("充值笔数(笔)： "+u(v.tableCountData.transactions_number),1)])),_:1}),s(w,{size:"small",plain:"",type:"danger"},{default:d((()=>[c("充值金额(元)： "+u(v.tableCountData.recharge_amount),1)])),_:1})])),_:1})])),_:1})]),r("div",q,[s(z,{onKeyup:a[0]||(a[0]=p((e=>v.handleSearch()),["enter"])),size:"small",modelValue:v.query.nameOrPhone,"onUpdate:modelValue":a[1]||(a[1]=e=>v.query.nameOrPhone=e),placeholder:"请输入姓名或手机号",class:"handle-input mr10"},null,8,["modelValue"]),M,s(P,{clearable:"",modelValue:v.query.receivePaperInvoice,"onUpdate:modelValue":a[2]||(a[2]=e=>v.query.receivePaperInvoice=e),filterable:"",size:"small",placeholder:"全部",class:"w100"},{default:d((()=>[s(x,{key:"1",label:"已发派",value:"1"}),s(x,{key:"0",label:"未派发",value:"0"})])),_:1},8,["modelValue"]),T,s(D,{size:"small",modelValue:v.form.time,"onUpdate:modelValue":a[3]||(a[3]=e=>v.form.time=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",class:"datepicker",onChange:v.getQueryDate},null,8,["modelValue","onChange"]),E,s(w,{size:"small",type:"primary",icon:"el-icon-search",onClick:v.handleSearch},{default:d((()=>[c("查询 ")])),_:1},8,["onClick"]),U,m((i(),h(w,{type:"success",size:"small",icon:"el-icon-plus",onClick:a[4]||(a[4]=e=>v.handleEdit(0,null,!0))},{default:d((()=>[c("充值 ")])),_:1})),[[Y,["road_xunjianczmana_cz","park_shoufeiczmana_cz"]]])]),A]),s(Q,{data:v.tableData,border:"",class:"table",ref:"multipleTable","max-height":y.tableH,"header-cell-class-name":"table-header",onSelectionChange:V.handleSelectionChange},{default:d((()=>[s(I,{type:"selection",width:"55",align:"center"}),s(I,{type:"index",label:"序号",width:"55",align:"center"}),s(I,{prop:"name",label:"姓名",width:"100",align:"center"}),s(I,{prop:"phone",label:"手机号码",align:"center"}),s(I,{prop:"recharge_time",label:"充值时间",align:"center"}),s(I,{prop:"recharge_amount",label:"充值金额(元)",align:"center"}),s(I,{label:"是否已派放发票",align:"center"},{default:d((e=>[c(u(1==e.row.receive_paper_invoice?"已派发":"未派发"),1)])),_:1}),s(I,{label:"操作",width:"220",align:"center"},{default:d((e=>[1!=e.row.receive_paper_invoice?m((i(),h(w,{key:0,size:"mini",type:"text",icon:"el-icon-edit",onClick:a=>v.handleInvoiceReceiving(e.$index,e.row,!1)},{default:d((()=>[c("领取发票登记 ")])),_:2},1032,["onClick"])),[[Y,["road_xunjianczmana_lqfpdj","park_shoufeiczmana_lqfpdj"]]]):g("",!0),1!=e.row.receive_paper_invoice?m((i(),h(w,{key:1,size:"mini",type:"text",icon:"el-icon-delete",class:"red",onClick:a=>v.handleDelete(e.$index,e.row)},{default:d((()=>[c("删除 ")])),_:2},1032,["onClick"])),[[Y,["road_xunjianczmana_delete","park_shoufeiczmana_delete"]]]):g("",!0)])),_:1})])),_:1},8,["data","max-height","onSelectionChange"]),r("div",O,[s(F,{background:"",layout:"total, prev, pager, next","current-page":v.query.pageIndex,"page-size":v.query.pageSize,total:v.pageTotal,onCurrentChange:v.handlePageChange},null,8,["current-page","page-size","total","onCurrentChange"])])]),s(K,{title:"充值验证",modelValue:v.editVisible,"onUpdate:modelValue":a[8]||(a[8]=e=>v.editVisible=e),width:"30%"},{footer:d((()=>[r("span",$,[s(w,{onClick:a[7]||(a[7]=e=>v.editVisible=!1)},{default:d((()=>[c("取 消")])),_:1}),s(w,{type:"primary",onClick:v.saveEdit},{default:d((()=>[c("去充值")])),_:1},8,["onClick"])])])),default:d((()=>[s(N,{onSubmit:a[6]||(a[6]=f((()=>{}),["prevent"])),"label-width":"90px",size:"small"},{default:d((()=>[s(L,{label:"充值密码"},{default:d((()=>[s(z,{type:"password",modelValue:v.formPatrolRecharge.password,"onUpdate:modelValue":a[5]||(a[5]=e=>v.formPatrolRecharge.password=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),s(K,{title:"充值",modelValue:v.patrolRechargeVisible,"onUpdate:modelValue":a[12]||(a[12]=e=>v.patrolRechargeVisible=e),width:"30%"},{footer:d((()=>[r("span",H,[s(w,{onClick:a[11]||(a[11]=e=>v.patrolRechargeVisible=!1)},{default:d((()=>[c("取 消")])),_:1}),s(w,{type:"primary",onClick:v.savePatrolRecharge},{default:d((()=>[c("确定")])),_:1},8,["onClick"])])])),default:d((()=>[s(N,{"label-width":"5px",size:"small"},{default:d((()=>[s(L,{label:""},{default:d((()=>[s(P,{modelValue:v.formPatrolRecharge.inspectId,"onUpdate:modelValue":a[9]||(a[9]=e=>v.formPatrolRecharge.inspectId=e),placeholder:"请选择巡检员",filterable:"",size:"small",class:"w"},{default:d((()=>[(i(!0),o(b,null,_(v.form.inspectManages,(e=>(i(),h(x,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),s(L,{label:""},{default:d((()=>[s(z,{type:"number",placeholder:"请输入充值金额",modelValue:v.formPatrolRecharge.rechargeAmount,"onUpdate:modelValue":a[10]||(a[10]=e=>v.formPatrolRecharge.rechargeAmount=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])}]]);export{Q as default};
