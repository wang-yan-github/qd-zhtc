var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,n=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,o=(e,a)=>{for(var l in a||(a={}))i.call(a,l)&&n(e,l,a[l]);if(t)for(var l of t(a))r.call(a,l)&&n(e,l,a[l]);return e},d=(e,t)=>a(e,l(t));import{f as s,b as p,L as u,q as m,r as c,M as h,o as g,h as _,i as b,w as f,c as y,l as k,m as x,k as C,F as v,j as w,t as V,p as q}from"./vendor.ac52fd94.js";import{_ as O,aY as S,bE as j,l as z,bF as D,bG as E,bH as U,bI as I}from"./index.1d57ac4a.js";const T={name:"provisionalPasslist",data:()=>({tableH:0}),setup(){const e=s({pageIndex:1,pageSize:15});let a=s({park_list:[],dialogT:"",qrCode:"",park_name:"",expire_time:""});const l=p([]),t=p(0),i=()=>{j(e).then((e=>{console.log(e.data),l.value=e.data.list,t.value=e.data.total}))};i();z(s({})).then((e=>{a.park_list=e.data}));const r=p(!1),n=p(!1),c=p(),h=s({expire_time:[{required:!0,message:"必填项",trigger:"blur"}],park_id:[{required:!0,message:"必填项",trigger:"blur"}],hxCount:[{required:!0,message:"必填项",trigger:"blur"},{type:"number",message:"必填项",min:1}],limit_time:[{required:!0,message:"必填项",trigger:"blur"}]});let g=s({park_id:"",expire_time:"",type:"1",repeat_type:!1,limit_time:"",hxCount:1,is_del:0,status:"",is_use:1});let _="";return{query:e,tableData:l,pageTotal:t,editVisible:r,result:a,form:g,rules:h,viewVisible:n,elForm:c,printImg:()=>{let e=s({base64:JSON.stringify(a.qrCode)});console.log(e.base64),D(s({base64:JSON.stringify(a.qrCode)})).then((e=>{const a=window.URL.createObjectURL(new Blob([e])),l=document.createElement("a");l.href=a,l.setAttribute("download","临时通行证.jpg"),document.body.appendChild(l),l.click()}))},handleView:(e,l)=>{let t=s({id:l.id,park_name:l.park_name,hxCount:l.hxCount,companyName:l.companyName});U(t).then((e=>{a.qrCode=e.data,a.park_name=l.park_name,a.expire_time=l.expire_time})),n.value=!0},handleSearch:()=>{e.pageIndex=1,i()},handlePageChange:a=>{e.pageIndex=a,i()},getData:i,handleDelete:(e,a)=>{u.confirm("确定要删除吗？","提示",{type:"warning"}).then((()=>{let e=s({is_del:"1",id:a.id});E(e).then((e=>{console.log(e),m.success("删除成功")})).then((()=>{i()}))})).catch((()=>{}))},handleEdit:(e,l,t)=>{t?(a.dialogT="新增",_="",g.park_id="",g.hxCount=1):(a.dialogT="编辑",_=l.id,Object.keys(g).forEach((e=>{g[e]=l[e]})),g.repeat_type=1==l.repeat_type),r.value=!0},handleStop:(e,a,l)=>{u.confirm("请确定当前操作？","提示",{type:"warning"}).then((()=>{let e=s({is_use:l,id:a.id});E(e).then((e=>{console.log(e),m.success("操作成功")})).then((()=>{i()}))})).catch((()=>{}))},saveEdit:()=>{c.value.validate((a=>{if(a)if(_){let e=s(d(o({id:_},g),{repeat_type:g.repeat_type?1:0}));E(e).then((e=>{console.log(e),m.success("修改成功"),c.value.resetFields(),r.value=!1})).then((()=>{i()}))}else I(d(o({},g),{repeat_type:g.repeat_type?1:0})).then((e=>{console.log(e.data)})).then((()=>{e.pageIndex=1,c.value.resetFields(),r.value=!1,m.success("添加成功"),i()}))}))},handlerTypeChange:e=>{1==e&&(g.hxCount=1,g.repeat_type=!1)},multipleSelection:[],handleCancel:()=>{c.value.resetFields(),g.park_id="",g.expire_time="",g.type="1",g.repeat_type=!1,g.limit_time="",g.hxCount=1,r.value=!1},value:!0,activeName:"first"}},methods:{handleSelectionChange(e){this.selectedData=e},handleDeleteAll(){u.confirm("确定要删除吗？","提示",{type:"warning"}).then((()=>{var e=this,a=this.selectedData,l="";a?(a.forEach((function(e,a){l=l+e.id+","})),S({areaIds:l}).then((a=>{m.success("删除成功"),e.getData()}))):m.warning("请选择一条记录")})).catch((()=>{}))}},mounted(){},created(){let e=document.documentElement.clientHeight||document.body.clientHeight;this.tableH=e-308+"px"}},H={class:"container"},P={class:"handle-box"},F={class:"left-panel"},N={class:"right-panel"},Y=b("div",{class:"clear"},null,-1),L={class:"pagination"},M={class:"dialog-footer"},$={style:{"margin-bottom":"20px"}},A={style:{"margin-bottom":"10px"}},J={style:{margin:"0 auto 30px",height:"250px",overflow:"hidden"}},R=["src"],B={class:"dialog-footer"};var G=O(T,[["render",function(e,a,l,t,i,r){const n=c("el-button"),o=c("el-option"),d=c("el-select"),s=c("el-table-column"),p=c("el-tag"),u=c("el-table"),m=c("el-pagination"),O=c("el-form-item"),S=c("el-date-picker"),j=c("el-radio"),z=c("el-radio-group"),D=c("el-input-number"),E=c("el-checkbox"),U=c("el-input"),I=c("el-form"),T=c("el-dialog"),G=h("permission");return g(),_("div",null,[b("div",H,[b("div",P,[b("div",F,[f((g(),y(n,{type:"primary",size:"small",icon:"el-icon-plus",onClick:a[0]||(a[0]=e=>t.handleEdit(0,null,!0))},{default:k((()=>[x("添加 ")])),_:1})),[[G,"park_passlist_add"]])]),b("div",N,[C(d,{modelValue:t.query.park_id,"onUpdate:modelValue":a[1]||(a[1]=e=>t.query.park_id=e),filterable:"",size:"small",placeholder:"所有停车场",class:"w100 mr10",clearable:""},{default:k((()=>[(g(!0),_(v,null,w(t.result.park_list,((e,a)=>(g(),y(o,{key:a,label:e.park_name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),C(n,{size:"small",type:"primary",icon:"el-icon-search",onClick:t.handleSearch},{default:k((()=>[x("查询 ")])),_:1},8,["onClick"])]),Y]),C(u,{data:t.tableData,border:"",class:"table","max-height":i.tableH,ref:"multipleTable","header-cell-class-name":"table-header",onSelectionChange:r.handleSelectionChange},{default:k((()=>[C(s,{type:"index",label:"序号",width:"55",align:"center"}),C(s,{prop:"park_name",label:"停车场名称",align:"center"}),C(s,{prop:"address",label:"停车场地址",align:"center"}),C(s,{prop:"hxCount",label:"剩余使用次数",align:"center"}),C(s,{prop:"limit_time",label:"使用限制",align:"center"},{default:k((e=>[x(V(2==e.row.type&&1==e.row.repeat_type?"同车牌使用一次":"无"),1)])),_:1}),C(s,{prop:"limit_time",label:"限制离场时间(分钟)",align:"center"}),C(s,{prop:"create_time",label:"添加时间",align:"center"}),C(s,{prop:"expire_time",label:"失效时间",align:"center"}),C(s,{label:"状态",align:"center",width:"100"},{default:k((e=>[1==e.row.status?(g(),y(p,{key:0,size:"small",type:"1"===e.row.status?"success":"0"===e.row.status?"danger":""},{default:k((()=>[x("有效 ")])),_:2},1032,["type"])):(g(),y(p,{key:1,size:"small",type:"1"===e.row.status?"success":"0"===e.row.status?"danger":""},{default:k((()=>[x("失效 ")])),_:2},1032,["type"]))])),_:1}),C(s,{label:"操作",width:"320",align:"center"},{default:k((e=>[f((g(),y(n,{size:"mini",type:"text",icon:"el-icon-edit",onClick:a=>t.handleEdit(e.$index,e.row,!1)},{default:k((()=>[x("编辑 ")])),_:2},1032,["onClick"])),[[G,"park_passlist_edit"]]),f((g(),y(n,{size:"mini",type:"text",icon:"el-icon-view",onClick:a=>t.handleView(e.$index,e.row)},{default:k((()=>[x("通行二维码 ")])),_:2},1032,["onClick"])),[[G,"park_passlist_qrcode"]]),f((g(),y(n,{size:"mini",type:"text",icon:"el-icon-delete",class:"red",onClick:a=>t.handleDelete(e.$index,e.row)},{default:k((()=>[x("删除 ")])),_:2},1032,["onClick"])),[[G,"park_passlist_delete"]])])),_:1})])),_:1},8,["data","max-height","onSelectionChange"]),b("div",L,[C(m,{background:"",layout:"total, prev, pager, next","current-page":t.query.pageIndex,"page-size":t.query.pageSize,total:t.pageTotal,onCurrentChange:t.handlePageChange},null,8,["current-page","page-size","total","onCurrentChange"])])]),C(T,{title:t.result.dialogT,modelValue:t.editVisible,"onUpdate:modelValue":a[9]||(a[9]=e=>t.editVisible=e),width:"30%"},{footer:k((()=>[b("span",M,[C(n,{onClick:t.handleCancel},{default:k((()=>[x("取 消")])),_:1},8,["onClick"]),C(n,{type:"primary",onClick:a[8]||(a[8]=e=>t.saveEdit())},{default:k((()=>[x("确 定")])),_:1})])])),default:k((()=>[C(I,{"label-width":"110px",rules:t.rules,model:t.form,ref:"elForm"},{default:k((()=>[C(O,{label:"可用停车场",prop:"park_id"},{default:k((()=>[C(d,{modelValue:t.form.park_id,"onUpdate:modelValue":a[2]||(a[2]=e=>t.form.park_id=e),placeholder:"请选择",class:"w"},{default:k((()=>[(g(!0),_(v,null,w(t.result.park_list,((e,a)=>(g(),y(o,{key:a,label:e.park_name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),C(O,{label:"失效日期",prop:"expire_time"},{default:k((()=>[C(S,{style:{width:"100%"},modelValue:t.form.expire_time,"onUpdate:modelValue":a[3]||(a[3]=e=>t.form.expire_time=e),placeholder:"请选择失效时间",type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])])),_:1}),C(O,{label:"可以使用次数",prop:"hxCount"},{default:k((()=>[b("div",null,[C(z,{modelValue:t.form.type,"onUpdate:modelValue":a[4]||(a[4]=e=>t.form.type=e),style:{"margin-right":"50px"},onChange:t.handlerTypeChange},{default:k((()=>[C(j,{label:"1"},{default:k((()=>[x("单次核销")])),_:1}),C(j,{label:"2"},{default:k((()=>[x("多次核销")])),_:1})])),_:1},8,["modelValue","onChange"]),C(D,{placeholder:"请输入次数",modelValue:t.form.hxCount,"onUpdate:modelValue":a[5]||(a[5]=e=>t.form.hxCount=e),disabled:1==t.form.type,min:1,max:99},null,8,["modelValue","disabled"])])])),_:1}),2==t.form.type?(g(),y(O,{key:0,label:"使用限制",prop:"repeat_type"},{default:k((()=>[C(E,{modelValue:t.form.repeat_type,"onUpdate:modelValue":a[6]||(a[6]=e=>t.form.repeat_type=e)},{default:k((()=>[x("同一车牌仅可使用一次")])),_:1},8,["modelValue"])])),_:1})):q("",!0),C(O,{label:"限时离场时间",prop:"limit_time"},{default:k((()=>[C(U,{modelValue:t.form.limit_time,"onUpdate:modelValue":a[7]||(a[7]=e=>t.form.limit_time=e),placeholder:"请输入限时离场时间"},{append:k((()=>[x("分钟")])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["title","modelValue"]),C(T,{title:"优惠二维码",modelValue:t.viewVisible,"onUpdate:modelValue":a[12]||(a[12]=e=>t.viewVisible=e),width:"460px"},{footer:k((()=>[b("span",B,[C(n,{onClick:a[10]||(a[10]=e=>t.viewVisible=!1)},{default:k((()=>[x("关 闭")])),_:1}),C(n,{type:"primary",onClick:a[11]||(a[11]=e=>t.printImg())},{default:k((()=>[x("下 载")])),_:1})])])),default:k((()=>[b("div",$,[b("h4",A,V(t.result.park_name),1),b("span",null,"失效时间: "+V(t.result.expire_time),1)]),b("div",J,[b("img",{style:{width:"100%"},src:"data:image/png;base64,"+t.result.qrCode,alt:""},null,8,R)])])),_:1},8,["modelValue"])])}]]);export{G as default};
