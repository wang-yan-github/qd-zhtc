import{f as e,b as a,u as l,q as t,r as u,M as n,o as i,h as s,i as o,k as r,l as c,c as v,t as d,p,w as m,m as g,L as h,N as f,a as b}from"./vendor.ac52fd94.js";import{f as _,d as y,g as w,a as C,s as I}from"./operateCar.eac1482d.js";import{F as x}from"./file_url.ec979fed.js";import{_ as T}from"./index.1d57ac4a.js";const k={class:"container"},V={class:"pagination"};var E=T({name:"trafficcarnummana",components:{},data:()=>({uploadUrl:x.file_img_url,imgViewUrl:x.file_hx_img_url,tableH:0}),setup(){const u=e({phone:"",isCheck:!1,car_type:"",car_no:"",roster_type:"",pageIndex:1,pageSize:15}),n=a([{value:"选项1",label:"黄金糕"},{value:"选项2",label:"双皮奶"},{value:"选项3",label:"蚵仔煎"},{value:"选项4",label:"龙须面"},{value:"选项5",label:"北京烤鸭"}]),i=a([]),s=a(!1),o=a(""),r=a(""),c=a([]),v=a(0),d=a(!0);1==localStorage.getItem("user_type")&&(d.value=!1);const p=l(),m=()=>{u.isCheck?u.car_type="3":u.car_type="",_(u).then((e=>{c.value=e.data.list,v.value=e.data.total}))};m();const g=a(!1);let T=a([]),k=a([]),V=a([]),E=a([]),S=a([]),D=a([]),F=a([]),O=a(!1),U=a(""),z=a(!1),N=a(""),P=a(!1),Y=a(""),B=a(null),j=a(null),G=a(null);const L=a(!1),M=a(""),R=a("");let H=a(null),q=a(null),$=a("");let A=e({eg1:"",eg2:""});e({excel:""});const W=a(!1),J=a(!1),K=a(!1);let Q=e({name:"",address:"",czroptions:[]});w({type:"rosterType"}).then((e=>{Q.czroptions=e.data}));let X=e({id:"",roster_type:"",whitelist_type:"0",reason:"",name:"",phone:"",company_name:"",cut_off_date:"",deformity_cert:"",deformity_picture_id:""});const Z=a(!1),ee=a(!1),ae=e({title:"",carNo:"",msg:""});let le=a(null);const te=e=>`${e.getFullYear()}-${e.getMonth()+1>=10?e.getMonth()+1:"0"+(e.getMonth()+1)}-${e.getDate()>=10?e.getDate():"0"+e.getDate()}`,ue=a([]),ne=a([]),ie=a(""),se=a("");return{dateToFormat:te,fileIds:ue,fileList2:ne,imageUrl:ie,imageId:se,file_img:i,fileurl:x.file_img_url,query:u,upload:le,tableData:c,pageTotal:v,isControl:d,editVisible:W,viewVisible:J,msginfo:ae,whiteType:Z,disableType:ee,handleCommand:(e,a)=>{if(f((e=>{le.value.clearFiles()})),X.id=a.id,X.roster_type=e,ae.carNo=a.car_no,X.whitelist_type="0",X.reason="",X.name="",X.phone="",X.company_name="",X.cut_off_date="",X.deformity_cert="",ne.value=[],ie.value="",se.value="",ue.value=[],"3"==e)Z.value=!0,ee.value=!1,X.whitelist_type=a.whitelist_type,ae.title="加入白名单",ae.msg="加入白名单，停车将不会再产生费用";else if("4"==e)Z.value=!1,ee.value=!0,ae.title="加入残疾人名单",ae.msg="加入残疾人名单";else switch(Z.value=!1,ee.value=!1,e){case"1":ae.title="加入普通名单",ae.msg="恢复为普通名单";break;case"2":ae.title="加入黑名单",ae.msg="加入黑名单"}K.value=!0},form:Q,formatCarNo:e=>null!=e.member_id&&e.member_id?"是":"否",dateFormat:(e,a)=>{var l=e.bind_date;if(null!=l&&null!=l){var t=new Date(l),u=t.getFullYear(),n=t.getMonth()+1,i=t.getDate(),s=t.getHours(),o=t.getMinutes(),r=t.getSeconds();return u+"-"+(n<10?"0"+n:n)+"-"+(i<10?"0"+i:i)+" "+(s<10?"0"+s:s)+":"+(o<10?"0"+o:o)+":"+(r<10?"0"+r:r)}},operateCarnoParams:X,dialogT:"编辑",handleSearch:()=>{u.pageIndex=1,m()},handlePageChange:e=>{u.pageIndex=e,m()},handleDelete:e=>{h.confirm("确定要删除吗？","提示",{type:"warning"}).then((()=>{t.success("删除成功"),c.value.splice(e,1)})).catch((()=>{}))},handleEdit:(e,a,l)=>{p.push("/roadedit")},inputFileClick:()=>{var e=document.createEvent("MouseEvents");e.initEvent("click",!0,!0),document.getElementById("inputFile").dispatchEvent(e)},handleView:(e,a)=>{Object.keys(Q).forEach((e=>{Q[e]=a[e]})),J.value=!0},bindRoad:(e,a)=>{p.push({path:"/carnumenter",query:{id:a.id}})},saveEdit:()=>{h.confirm("确定变更名单类型吗？","提示",{type:"warning"}).then((()=>{""!=X.cut_off_date&&(X.cut_off_date=te(X.cut_off_date)),C(X).then((e=>{0==e.code?(t.success("操作成功！"),K.value=!1,m()):t.error(e.msg)}))})).catch((()=>{}))},multipleSelection:[],dialogImageUrl:"",ppVisible:!1,activeName:"first",map:null,saveBatch:a=>{if(null==V.value&&(V=k.value,S=E.value,F=D.value),""==k.value&&""==E.value&&""==D.value)t({showClose:!0,message:"车牌、姓名、手机号不能为空！",type:"error"});else{let a=e({blueCars:V.value,yellowCars:S.value,greenCars:F.value,whitelist_type:A.eg1,company_name:o,cut_off_date:r.value,reason:A.eg2});console.log(a),I(a).then((e=>{console.log(e),0==e.code?(t({showClose:!0,message:"新增成功！",type:"success"}),m(),g.value=!1):(t({showClose:!0,message:e.msg,type:"error"}),g.value=!0)}))}},bmdVisible:K,batchVisible:g,batchForm:A,batchAdd:()=>{g.value=!0,E.value=[],k.value=[],D.value=[],A.eg1="0",A.eg2="",O.value=!1,z.value=!1,P.value=!1,o.value="",r.value="",V.value=[],S.value=[],F.value=[]},blueTags:k,yellowTags:E,greenTags:D,inputVisible:O,inputValue:U,inputVisibleY:z,inputValueY:N,inputVisibleG:P,inputValueG:Y,saveTagInput:j,saveTagInputY:B,saveTagInputG:G,handleClose:e=>{k.value.splice(k.value.indexOf(e),1),"blueTags"==T.value?V.value.splice(V.value.indexOf(e),1):"yellowTags"==T.value?S.value.splice(S.value.indexOf(e),1):"greenTags"==T.value&&F.value.splice(F.value.indexOf(e),1)},showInput:()=>{O.value=!0,f((e=>{j.value.input.focus()}))},download:()=>{y(e({})).then((e=>{const a=window.URL.createObjectURL(new Blob([e])),l=document.createElement("a");l.href=a,l.setAttribute("download","白名单登记表.xlsx"),document.body.appendChild(l),l.click()}))},handleInputConfirm:()=>{T.value="blueTags",U.value&&k.value.push(U.value),O.value=!0,U.value="",L.value=!0,M.value="",R.value="",$=k,setTimeout((()=>{f((e=>{H.value.input.focus()}))}),0)},handleCloseY:e=>{E.value.splice(E.value.indexOf(e),1)},showInputY:()=>{z.value=!0,f((e=>{B.value.input.focus()}))},handleInputConfirmY:()=>{T.value="yellowTags";let e=N.value;e&&E.value.push(e),z.value=!0,N.value="",L.value=!0,M.value="",R.value="",$=E,setTimeout((()=>{f((e=>{H.value.input.focus()}))}),0)},handleCloseG:e=>{D.value.splice(D.value.indexOf(e),1)},showInputG:()=>{P.value=!0,f((e=>{G.value.input.focus()}))},exportImport:()=>{var e=new FormData;e.append("file",document.getElementById("inputFile").files[0]),b({url:x.file_down+"operatecarno/importWhiteList",method:"POST",data:e,headers:{"Content-Type":"multipart/form-data",Authorization:localStorage.getItem("token_value")}}).then((e=>{var a=e.data;0==a.code?(t({showClose:!0,message:a.data,type:"success"}),s.value=!1,m()):t({showClose:!0,message:a.msg,type:"error"}),document.getElementById("inputFile").value=""}))},handleInputConfirmG:()=>{T.value="greenTags";let e=Y.value;e&&D.value.push(e),P.value=!0,Y.value="",L.value=!0,M.value="",R.value="",$=D,setTimeout((()=>{f((e=>{H.value.input.focus()}))}),0)},viewVisibleInner:L,carName:M,carPhone:R,focusPhoneInput:()=>{f((e=>{q.value.input.focus()}))},focusName:H,focusPhone:q,carInfoSure:()=>{M.value&&R.value?(L.value=!1,"blueTags"==T.value?V.value.push(k.value+"-"+M.value+"-"+R.value):"yellowTags"==T.value?S.value.push(E.value+"-"+M.value+"-"+R.value):"greenTags"==T.value&&F.value.push(D.value+"-"+M.value+"-"+R.value)):t({showClose:!0,message:"姓名和手机号不能为空！",type:"error"})},innerClose:()=>{L.value=!1,$.value.pop(),t({showClose:!0,message:"取消添加车牌信息！",type:"error"})},tags:$,handleInputConfirmBlur:()=>{if(!U.value)return!1;k.value.push(U.value),O.value=!0,U.value="",L.value=!0,M.value="",R.value="",$=k,setTimeout((()=>{f((e=>{H.value.input.focus()}))}),0)},handleInputConfirmYBlur:()=>{let e=N.value;if(""==e)return!1;E.value.push(e),z.value=!0,N.value="",L.value=!0,M.value="",R.value="",$=E,setTimeout((()=>{f((e=>{H.value.input.focus()}))}),0)},handleInputConfirmGBlur:()=>{let e=Y.value;if(""==e)return!1;D.value.push(e),P.value=!0,Y.value="",L.value=!0,M.value="",R.value="",$=D,setTimeout((()=>{f((e=>{H.value.input.focus()}))}),0)},valueC:o,optionsC:n,timeC:r,viewVisibleExcel:s,excelImport:()=>{s.value=!0}}},methods:{handleSelectionChange(e){this.selectedData=e},handleDeleteAll(){var e=this,a=this.selectedData;a?(a.forEach((function(a,l){e.tableData.forEach((function(l,t){a===l&&e.tableData.splice(t,1)}))})),t.success("删除成功"),this.$refs.multipleTable.clearSelection()):t.warning("请选择一条记录")},handleSuccess(e,a,l){this.fileIds.push(e.id+""),this.imageId=e.id+"",a.id=e.id,this.operateCarnoParams.deformity_picture_id=e.id,this.imageUrl=URL.createObjectURL(a.raw),console.log("imageUrl",this.imageUrl),console.log(e,a,l)},handleRemove(a,l){console.log(a,l);let u=this.fileIds.indexOf(a.id+"");-1==u&&(u=this.fileIds.indexOf(a.id));let n=0;-1!=u&&delImgFile(e({id:a.id})).then((e=>{n=e.success})).then((()=>{0==n?(t.success("操作成功"),this.fileIds.splice(u,1)):-1==n&&t.error("操作失败!")}))},handlePictureCardPreview(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},imgurl:function(e){if(""!=e&&null!=e)return e}},mounted(){},created(){let e=document.documentElement.clientHeight||document.body.clientHeight;this.tableH=e-308+"px"}},[["render",function(e,a,l,t,h,f){const b=u("el-table-column"),_=u("el-tag"),y=u("el-button"),w=u("el-table"),C=u("el-pagination"),I=n("permission");return i(),s("div",null,[o("div",k,[r(w,{data:t.tableData,border:"",class:"table","max-height":h.tableH,ref:"multipleTable","header-cell-class-name":"table-header",onSelectionChange:f.handleSelectionChange},{default:c((()=>[r(b,{type:"index",label:"序号",width:"55",align:"center"}),r(b,{prop:"car_no",label:"车牌号",width:"200",align:"center"},{default:c((e=>["1"==e.row.car_type?(i(),v(_,{key:0,size:"small",textContent:d(e.row.car_no)},null,8,["textContent"])):"2"==e.row.car_type?(i(),v(_,{key:1,size:"small",type:"success",textContent:d(e.row.car_no)},null,8,["textContent"])):"3"==e.row.car_type?(i(),v(_,{key:2,size:"small",type:"warning",textContent:d(e.row.car_no)},null,8,["textContent"])):p("",!0)])),_:1}),r(b,{prop:"carTypeName",label:"车牌样式",width:"200",align:"center"}),r(b,{prop:"member_id",label:"会员车牌（是/否）",width:"200",align:"center",formatter:t.formatCarNo},null,8,["formatter"]),r(b,{prop:"rosterTypeName",label:"名单类型",align:"center"}),r(b,{prop:"phone",label:"绑定账号",align:"center"}),r(b,{prop:"bind_date",label:"绑定时间",align:"center",formatter:t.dateFormat},null,8,["formatter"]),r(b,{prop:"reason",label:"理由说明",align:"center"}),t.isControl?(i(),v(b,{key:0,label:"操作",align:"center"},{default:c((e=>[m((i(),v(y,{size:"mini",type:"text",icon:"el-icon-warning-outline",onClick:a=>t.bindRoad(e.$index,e.row)},{default:c((()=>[g("完善信息 ")])),_:2},1032,["onClick"])),[[I,"raod_nummana1_wsxx"]])])),_:1})):p("",!0)])),_:1},8,["data","max-height","onSelectionChange"]),o("div",V,[r(C,{background:"",layout:"total, prev, pager, next","current-page":t.query.pageIndex,"page-size":t.query.pageSize,total:t.pageTotal,onCurrentChange:t.handlePageChange},null,8,["current-page","page-size","total","onCurrentChange"])])])])}],["__scopeId","data-v-ce92c2c4"]]);export{E as default};
