import{P as e,b as l,f as a,L as t,q as r,r as o,M as d,o as n,h as i,i as u,w as s,c as p,l as c,m,k as f,t as h,p as g,F as _,j as v,n as y,N as b,s as V,x as k}from"./vendor.ac52fd94.js";import{j as w}from"./index.8c41d9e3.js";import{_ as C,N as x,O as T,P as S,Q as U,R as I,S as q,T as z,l as D}from"./index.1d57ac4a.js";const P={name:"userList",components:{ElScrollbar:e},setup(){const e=l(!1),o=l(null),d=l(null),n=a({pageIndex:1,pageSize:15}),i=l([]),u=l(0),s=()=>{T(n).then((e=>{i.value=e.data.list,u.value=e.data.total}))};s();const p=l(!1),c=l(!1);l("");const m=l([]),f=l([]),h=()=>{D(a({})).then((e=>{const l=e.data,a=[];for(let t=0;t<l.length;t++){let e=l[t];a.push({key:e.id,label:e.park_name}),m.value=a}}))};let g=l({});const _=l(""),v=l([]),y=()=>{z(a({})).then((e=>{v.value=e.data}))};y();let V=l(null),k=l(null),C=l([]),x=l([]),P=l(0),A=l(1),L=l(24),E=l({});const $=l(!1),j=()=>{x=[],b((()=>{const e=V.value;let l=0;if(x.push(l),e)for(let a=0;a<e.length;a++){l+=e[a].clientHeight,x.push(l)}}))},M=()=>{b((()=>{const e=k.value.$el.querySelector(".el-scrollbar__wrap");e.onscroll=()=>{let l=e.scrollTop;const a=x;for(let e=0;e<a.length-1;e++){let t=a[e],r=a[e+1];if(t<=l&&l<r){P.value=e;let l=Math.floor(e/L)+1;return void(A=l)}}}}))};return{query:n,tableData:i,pageTotal:u,editVisible:p,form:g,dialogT:_,addVisible:c,categorys:v,roaddatas:m,parkingIds:f,formRules:{name:[{required:!0,message:"请输入名称",trigger:"blur"}],category:[{required:!0,message:"请选择车辆类型",trigger:"blur"}],monthType:[{required:!0,message:"请选择包月类型",trigger:"blur"}],price_type:[{required:!0,message:"请选择价格类型",trigger:"blur"}],price:[{required:!0,message:"请输入价格",trigger:["blur","change"]}]},addform:o,editform:d,queryDict:y,handleSearch:()=>{n.pageIndex=1,s()},handlePageChange:e=>{n.pageIndex=e,s()},handleDelete:(e,l)=>{t.confirm("确定要删除吗？","提示",{type:"warning"}).then((()=>{S(a({id:l.id})).then((e=>{0===e.code&&(r.success("删除成功"),s())})),i.value.splice(e,1)})).catch((()=>{}))},handleEdit:(l,t,r)=>{_.value="编辑",g.value={},p.value=!0,h(),U(a({configId:t.id})).then((l=>{g.value=l.data,f.value=l.data.roadIds,"1"==g.value.price_type?e.value=!1:e.value=!0})),b((()=>{d.value.clearValidate()}))},handleAdd:(l,a,t)=>{_.value="新增",g.value={},g.value.price_type="1",g.value.category="1",g.value.monthType="1",e.value=!1,c.value=!0,f.value=[],h(),b((()=>{o.value.clearValidate()}))},saveEdit:()=>{d.value.validate((e=>{if(e){if(""===f.value.toString())return r.error("请选择停车场"),!1;if(f.value.length>1)return r.error("每个包月配置方案最多绑定一个停车场"),!1;if("2"==g.value.price_type&&(""==g.value.new_price||null==g.value.new_price||null==g.value.new_price))return r.error("请输入明年价格"),!1;p.value=!1,g.value.roadIds=null,g.value.parkingIds=f.value.toString(),I(g.value).then((e=>{0===e.code?(p.value=!1,r.success(e.msg),s()):r.error(e.msg)}))}}))},save:()=>{o.value.validate((e=>{if(e){if(""===f.value.toString())return r.error("请选择停车场"),!1;if(f.value.length>1)return r.error("每个包月配置方案最多绑定一个停车场"),!1;if("2"==g.value.price_type&&(""==g.value.new_price||null==g.value.new_price||null==g.value.new_price))return r.error("请输入明年价格"),!1;g.value.parking_type="1",g.value.parkingIds=f.value.toString(),g.value.roadIds=null,q(g.value).then((e=>{0===e.code?(c.value=!1,r.success(e.msg),s()):r.error(e.msg)}))}}))},getData:s,multipleSelection:[],viewVisible:$,handleView:(e,l)=>{b((()=>{j(),M()}));let a=[];l.parkList.forEach((function(e){a.push(e.park_name)})),a=a.map((function(e){return{name:e}})),w.setOptions({checkPolyphone:!1,charCase:0});let t=[],r=[];for(let i=0;i<a.length;i++){let e=a[i].name,l=w.getCamelChars(e).substring(0,1).toUpperCase();a[i].initial=l,-1===t.indexOf(l)&&t.push(l)}t.sort();for(var o=0;o<t.length;o++)r.push({id:o,key:t[o]});C.value=[];for(o=0;o<26;o++)C.value.push({id:"",key:String.fromCharCode(65+o)});for(o=0;o<r.length;o++)for(var d=0;d<C.value.length;d++)r[o].key===C.value[d].key&&(C.value[d].id=r[o].id);let n={};for(let i=0;i<t.length;i++)n[t[i]]=a.filter((e=>e.initial===t[i]));E.value=n,$.value=!0},charList:C,listHeight:x,currentIndex:P,indexPage:A,indexLimit:L,indexData:E,listGroup:V,scrollbar:k,calculateHeight:j,scrollToLetter:e=>{""!==e.id&&void 0!==e.id&&b((()=>{k.value.$el.querySelector(".el-scrollbar__wrap").scrollTop=x[e.id],P.value=e.id}))},handleScroll:M,closeAddress:()=>{k.value.$el.querySelector(".el-scrollbar__wrap").scrollTop=0,P.value=0,$.value=!1},newPriceShow:e}},computed:{indexList(){return this.charList}},methods:{radioBtnPriceType(e){this.newPriceShow="1"!=e},handleSelectionChange(e){this.selectedData=e},handleDeleteAll(){var e=this,l=this.selectedData;t.confirm("确定要删除吗？","提示",{type:"warning"}).then((()=>{var t="";l?(l.forEach((function(e,l){t=t+e.id+","})),x(a({ids:t})).then((l=>{0===l.code?(r.success(l.msg),e.getData()):r.error(l.msg)}))):r.warning("请选择一条记录")})).catch((()=>{}))}}},A={class:"container"},L={class:"handle-box"},E={class:"left-panel"},$={class:"right-panel"},j=(e=>(V("data-v-13ac4f2b"),e=e(),k(),e))((()=>u("div",{class:"clear"},null,-1))),M={key:0,style:{color:"#00a0e9"}},R={key:1,style:{color:"#2da96d"}},B={key:0,style:{color:"#2da96d"}},H={key:1,style:{color:"#00a0e9"}},O={key:0,style:{color:"#00a0e9"}},G={key:1,style:{color:"#2da96d"}},N={class:"no-warp"},F={class:"pagination"},Q={class:"dialog-footer"},J={class:"dialog-footer"},K={class:"index-bar-content"},W=["id"],X={class:"title-key"},Y={class:"content-container"},Z={class:"char-list"},ee=["onClick"];var le=C(P,[["render",function(e,l,a,t,r,b){const V=o("el-button"),k=o("el-input"),w=o("el-table-column"),C=o("el-tag"),x=o("el-table"),T=o("el-pagination"),S=o("el-form-item"),U=o("el-radio"),I=o("el-option"),q=o("el-select"),z=o("el-col"),D=o("el-row"),P=o("el-radio-group"),le=o("el-transfer"),ae=o("el-form"),te=o("el-dialog"),re=o("el-scrollbar"),oe=d("permission");return n(),i("div",null,[u("div",A,[u("div",L,[u("div",E,[s((n(),p(V,{type:"primary",size:"small",icon:"el-icon-plus",onClick:l[0]||(l[0]=e=>t.handleAdd(0,null,!0))},{default:c((()=>[m("添加 ")])),_:1})),[[oe,"park_monthSetA_add"]]),s((n(),p(V,{type:"danger",size:"small",icon:"el-icon-delete",onClick:l[1]||(l[1]=e=>b.handleDeleteAll())},{default:c((()=>[m("批量删除 ")])),_:1})),[[oe,"park_monthSetA_deleteAll"]])]),u("div",$,[f(k,{size:"small",modelValue:t.query.name,"onUpdate:modelValue":l[2]||(l[2]=e=>t.query.name=e),placeholder:"名称",class:"handle-input mr10"},null,8,["modelValue"]),f(V,{size:"small",type:"primary",icon:"el-icon-search",onClick:t.handleSearch},{default:c((()=>[m("查询")])),_:1},8,["onClick"])]),j]),f(x,{data:t.tableData,border:"",class:"table",ref:"multipleTable","header-cell-class-name":"table-header",onSelectionChange:b.handleSelectionChange},{default:c((()=>[f(w,{type:"selection",width:"55",align:"center"}),f(w,{label:"序号",width:"55",align:"center"},{default:c((e=>[m(h(e.$index+1),1)])),_:1}),f(w,{prop:"name",label:"名称",width:"300",align:"center"}),f(w,{label:"价格(元/月)",width:"100",align:"center"},{default:c((e=>[m(h(e.row.price),1)])),_:1}),f(w,{prop:"monthType",label:"包月类型",align:"center",width:"100"},{default:c((e=>[1==e.row.monthType?(n(),i("p",M,"个人")):g("",!0),2==e.row.monthType?(n(),i("p",R,"公司")):g("",!0)])),_:1}),f(w,{prop:"category",label:"车辆类型",align:"center",width:"100"},{default:c((e=>[0==e.row.category?(n(),i("p",B,"大车")):g("",!0),1==e.row.category?(n(),i("p",H,"小车")):g("",!0)])),_:1}),f(w,{prop:"price_type",label:"价格类型",align:"center",width:"100"},{default:c((e=>[1==e.row.price_type?(n(),i("p",O,"永久")):g("",!0),2==e.row.price_type?(n(),i("p",G,"期限")):g("",!0)])),_:1}),f(w,{prop:"roads",label:"停车场",align:"center"},{default:c((e=>[u("div",N,[(n(!0),i(_,null,v(e.row.parkList,((l,a)=>(n(),p(C,{size:"small",onClick:l=>t.handleView(e.$index,e.row),key:a,class:"mar5"},{default:c((()=>[m(h(null==l.park_name?"":l.park_name),1)])),_:2},1032,["onClick"])))),128))])])),_:1}),f(w,{label:"操作",width:"180",align:"center"},{default:c((e=>[s((n(),p(V,{size:"mini",type:"text",icon:"el-icon-edit",onClick:l=>t.handleEdit(e.$index,e.row,!1)},{default:c((()=>[m("编辑 ")])),_:2},1032,["onClick"])),[[oe,"park_monthSetA_edit"]]),s((n(),p(V,{size:"mini",type:"text",icon:"el-icon-delete",class:"red",onClick:l=>t.handleDelete(e.$index,e.row)},{default:c((()=>[m("删除 ")])),_:2},1032,["onClick"])),[[oe,"park_monthSetA_delete"]])])),_:1})])),_:1},8,["data","onSelectionChange"]),u("div",F,[f(T,{background:"",layout:"total, prev, pager, next","current-page":t.query.pageIndex,"page-size":t.query.pageSize,total:t.pageTotal,onCurrentChange:t.handlePageChange},null,8,["current-page","page-size","total","onCurrentChange"])])]),f(te,{title:t.dialogT,modelValue:t.editVisible,"onUpdate:modelValue":l[12]||(l[12]=e=>t.editVisible=e),width:"800px",top:"5vh"},{footer:c((()=>[u("span",Q,[f(V,{onClick:l[11]||(l[11]=e=>t.editVisible=!1)},{default:c((()=>[m("取 消")])),_:1}),f(V,{type:"primary",onClick:t.saveEdit},{default:c((()=>[m("确 定")])),_:1},8,["onClick"])])])),default:c((()=>[f(ae,{"label-width":"70px","label-position":"top",size:"small",rules:t.formRules,ref:"editform",model:t.form},{default:c((()=>[f(S,{label:"名称",prop:"name"},{default:c((()=>[f(k,{modelValue:t.form.name,"onUpdate:modelValue":l[3]||(l[3]=e=>t.form.name=e)},null,8,["modelValue"])])),_:1}),f(S,{label:"包月类型",prop:"name"},{default:c((()=>[f(U,{modelValue:t.form.monthType,"onUpdate:modelValue":l[4]||(l[4]=e=>t.form.monthType=e),label:"1",border:""},{default:c((()=>[m("个人包月")])),_:1},8,["modelValue"]),f(U,{modelValue:t.form.monthType,"onUpdate:modelValue":l[5]||(l[5]=e=>t.form.monthType=e),label:"2",border:""},{default:c((()=>[m("公司包月")])),_:1},8,["modelValue"])])),_:1}),f(D,null,{default:c((()=>[f(z,{span:11},{default:c((()=>[f(S,{label:"车辆类型",paop:"category"},{default:c((()=>[f(q,{modelValue:t.form.category,"onUpdate:modelValue":l[6]||(l[6]=e=>t.form.category=e),placeholder:"请选择",class:"w100p"},{default:c((()=>[(n(!0),i(_,null,v(t.categorys,(e=>(n(),p(I,{key:e.dc_value,label:e.label,value:e.dc_value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),f(z,{class:"line",span:2}),f(z,{span:11},{default:c((()=>[f(S,{label:"价格(元/月)",prop:"price"},{default:c((()=>[f(k,{type:"number",modelValue:t.form.price,"onUpdate:modelValue":l[7]||(l[7]=e=>t.form.price=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),f(D,null,{default:c((()=>[f(z,{span:11},{default:c((()=>[f(S,{label:"价格类型",prop:"price_type"},{default:c((()=>[f(P,{modelValue:t.form.price_type,"onUpdate:modelValue":l[8]||(l[8]=e=>t.form.price_type=e),onChange:b.radioBtnPriceType},{default:c((()=>[f(U,{label:"1"},{default:c((()=>[m("永久")])),_:1}),f(U,{label:"2"},{default:c((()=>[m("期限")])),_:1})])),_:1},8,["modelValue","onChange"])])),_:1})])),_:1}),f(z,{class:"line",span:2}),t.newPriceShow?(n(),p(z,{key:0,span:11},{default:c((()=>[f(S,{label:"明年价格(元/月)",prop:"new_price"},{default:c((()=>[f(k,{type:"number",modelValue:t.form.new_price,"onUpdate:modelValue":l[9]||(l[9]=e=>t.form.new_price=e)},null,8,["modelValue"])])),_:1})])),_:1})):g("",!0)])),_:1}),f(S,{label:"停车区"},{default:c((()=>[f(le,{filterable:"","filter-method":e.filterMethod,"filter-placeholder":"请输入名称",titles:["待选择区域","已选择区域"],modelValue:t.parkingIds,"onUpdate:modelValue":l[10]||(l[10]=e=>t.parkingIds=e),data:t.roaddatas},null,8,["filter-method","modelValue","data"])])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["title","modelValue"]),f(te,{title:t.dialogT,modelValue:t.addVisible,"onUpdate:modelValue":l[22]||(l[22]=e=>t.addVisible=e),width:"800px",top:"5vh"},{footer:c((()=>[u("span",J,[f(V,{onClick:l[21]||(l[21]=e=>t.addVisible=!1)},{default:c((()=>[m("取 消")])),_:1}),f(V,{type:"primary",onClick:t.save},{default:c((()=>[m("确 定")])),_:1},8,["onClick"])])])),default:c((()=>[f(ae,{"label-width":"70px","label-position":"top",size:"small",rules:t.formRules,ref:"addform",model:t.form},{default:c((()=>[f(S,{label:"名称",prop:"name"},{default:c((()=>[f(k,{modelValue:t.form.name,"onUpdate:modelValue":l[13]||(l[13]=e=>t.form.name=e)},null,8,["modelValue"])])),_:1}),f(S,{label:"包月类型",prop:"monthType"},{default:c((()=>[f(U,{modelValue:t.form.monthType,"onUpdate:modelValue":l[14]||(l[14]=e=>t.form.monthType=e),label:"1",border:""},{default:c((()=>[m("个人包月")])),_:1},8,["modelValue"]),f(U,{modelValue:t.form.monthType,"onUpdate:modelValue":l[15]||(l[15]=e=>t.form.monthType=e),label:"2",border:""},{default:c((()=>[m("公司包月")])),_:1},8,["modelValue"])])),_:1}),f(D,null,{default:c((()=>[f(z,{span:11},{default:c((()=>[f(S,{label:"车辆类型",prop:"category"},{default:c((()=>[f(q,{modelValue:t.form.category,"onUpdate:modelValue":l[16]||(l[16]=e=>t.form.category=e),placeholder:"请选择",class:"w100p"},{default:c((()=>[(n(!0),i(_,null,v(t.categorys,(e=>(n(),p(I,{key:e.dc_value,label:e.label,value:e.dc_value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),f(z,{class:"line",span:2}),f(z,{span:11},{default:c((()=>[f(S,{label:"价格(元/月)",prop:"price"},{default:c((()=>[f(k,{type:"number",modelValue:t.form.price,"onUpdate:modelValue":l[17]||(l[17]=e=>t.form.price=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),f(D,null,{default:c((()=>[f(z,{span:11},{default:c((()=>[f(S,{label:"价格类型",prop:"price_type"},{default:c((()=>[f(P,{modelValue:t.form.price_type,"onUpdate:modelValue":l[18]||(l[18]=e=>t.form.price_type=e),onChange:b.radioBtnPriceType},{default:c((()=>[f(U,{label:"1"},{default:c((()=>[m("永久")])),_:1}),f(U,{label:"2"},{default:c((()=>[m("期限")])),_:1})])),_:1},8,["modelValue","onChange"])])),_:1})])),_:1}),f(z,{class:"line",span:2}),t.newPriceShow?(n(),p(z,{key:0,span:11},{default:c((()=>[f(S,{label:"明年价格(元/月)",prop:"new_price"},{default:c((()=>[f(k,{type:"number",modelValue:t.form.new_price,"onUpdate:modelValue":l[19]||(l[19]=e=>t.form.new_price=e)},null,8,["modelValue"])])),_:1})])),_:1})):g("",!0)])),_:1}),f(S,{label:"停车区"},{default:c((()=>[f(le,{filterable:"","filter-method":e.filterMethod,"filter-placeholder":"请输入城市拼音",titles:["待选择区域","已选择区域"],modelValue:t.parkingIds,"onUpdate:modelValue":l[20]||(l[20]=e=>t.parkingIds=e),data:t.roaddatas},null,8,["filter-method","modelValue","data"])])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["title","modelValue"]),f(te,{title:"停车场列表",modelValue:t.viewVisible,"onUpdate:modelValue":l[23]||(l[23]=e=>t.viewVisible=e),width:"840px",onClose:t.closeAddress},{default:c((()=>[u("div",K,[f(re,{style:{height:"100%"},ref:"scrollbar"},{default:c((()=>[(n(!0),i(_,null,v(t.indexData,((e,l)=>(n(),i("div",{id:l,class:"main-list",key:l,ref_for:!0,ref:"listGroup"},[u("div",X,h(l),1),u("div",Y,[(n(!0),i(_,null,v(e,((e,l)=>(n(),i("div",{class:"content-item",key:l},[f(C,{size:"small"},{default:c((()=>[m(h(e.name),1)])),_:2},1024)])))),128))])],8,W)))),128))])),_:1},512),u("ul",Z,[(n(!0),i(_,null,v(b.indexList,((e,l)=>(n(),i("li",{key:e.index,onClick:l=>t.scrollToLetter(e),class:y({active:t.currentIndex===e.id})},h(e.key)+" ",11,ee)))),128))])])])),_:1},8,["modelValue","onClose"])])}],["__scopeId","data-v-13ac4f2b"]]);export{le as default};
