import{f as e,b as l,q as a,L as t,r as i,M as o,o as d,h as r,i as n,w as s,c,l as u,m,k as p,I as g,t as h}from"./vendor.ac52fd94.js";import{U as f}from"./UE.013b43f7.js";import{d as v,a as _,e as b,s as y,b as w}from"./sysResourceIndex.2c650a03.js";import{F as x}from"./file_url.ec979fed.js";import{_ as C}from"./index.1d57ac4a.js";const I={name:"movePicList",components:{Ueditor:f},data:()=>({tableH:0,uploadUrl:x.file_img_url,imgViewUrl:x.file_hx_img_url,formRules:{title:[{required:!0,message:"必填项",trigger:"blur"}]}}),setup(){const i=e({title:"",category:"3",pageIndex:1,pageSize:15}),o=l([]),d=l(0),r=()=>{y(i).then((e=>{console.log(e),o.value=e.data.list,d.value=e.data.total}))};r();let n=l("编辑");const s=l(!1),c=l(!1),u=l({}),m=l([]),p=l([]),g=l(""),h=l("");let f=e({config:{initialFrameHeight:300,initialFrameWidth:"100%"}});return{query:i,tableData:o,pageTotal:d,editVisible:s,form:u,uform:f,fileIds:m,fileList2:p,imageId:h,imageUrl:g,dialogT:n,getData:r,handleSearch:()=>{i.pageIndex=1,r()},handlePageChange:e=>{i.pageIndex=e,r()},handleDelete:(l,i)=>{t.confirm("确定要删除吗？","提示",{type:"warning"}).then((()=>{let l=e({is_del:"1",id:i.id});b(l).then((e=>{console.log(e),a.success("删除成功")})).then((()=>{r()}))})).catch((()=>{}))},handleEdit:(l,a,t)=>{s.value=!0,u.value={},m.value=[],p.value=[],g.value="",h.value="",t?n.value="新增":(n.value="编辑",w(e({id:a.id})).then((e=>{u.value=e.data,""!=e.data.picture_id&&null!=e.data.picture_id?(m.value=e.data.picture_id.split(","),h.value=e.data.picture_id):(m.value=[],h.value=""),""!=e.data.fileList&&null!=e.data.fileList?(p.value=e.data.fileList,g.value=e.data.fileList[0].file_url):(p.value=[],g.value="")})))},multipleSelection:[],dialogImageUrl:"",dialogVisible:c}},created(){let e=document.documentElement.clientHeight||document.body.clientHeight;this.tableH=e-308+"px"},methods:{handleSuccess(e,l,a){this.fileIds.push(e.id+""),this.imageId=e.id+"",l.id=e.id,this.imageUrl=URL.createObjectURL(l.raw),console.log("imageUrl",this.imageUrl),console.log(e,l,a)},handleRemove(l,t){console.log("删除图片"),console.log(l,t);let i=this.fileIds.indexOf(l.id+"");-1==i&&(i=this.fileIds.indexOf(l.id));let o=0;-1!=i&&v(e({id:l.id})).then((e=>{o=e.success})).then((()=>{0==o?(a.success("操作成功"),this.fileIds.splice(i,1)):-1==o&&a.error("操作失败!")}))},handlePictureCardPreview(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},imgurl:function(e){if(""!=e&&null!=e)return e},handleSelectionChange(e){this.selectedData=e},handleDeleteAll(){t.confirm("确定要删除吗？","提示",{type:"warning"}).then((()=>{var e=this,l=this.selectedData;console.log(l);var t="";l?(l.forEach((function(e,l){t=t+e.id+","})),_({ids:t}).then((l=>{a.success("删除成功"),e.getData()}))):a.warning("请选择一条记录")})).catch((()=>{}))},editorReady(e){this.$refs.ue.setText(this.form.content)},saveEdit(e){let l=0,t=this;this.$refs[e].validate((e=>{e&&(t.form.content=this.$refs.ue.getUEContent(),""==t.form.content||null==t.form.content||null==t.form.content?a.error("请填写内容!"):(t.form.category="3",t.form.fileList=[],t.fileIds.length>0?t.form.picture_id=t.fileIds.join(","):t.form.picture_id="",t.form.picture_id=t.imageId,b(t.form).then((e=>{l=e.code})).then((()=>{0==l?(a.success("操作成功"),t.editVisible=!1,t.query.pageIndex=1,t.form.fileList=[],t.fileIds=[],t.imageId="",t.imageUrl="",this.$refs.ue.setText(""),t.getData()):-1==l&&a.error("操作失败!")}))))}))}}},U={class:"container"},V={class:"handle-box"},k={class:"left-panel"},S={class:"right-panel"},z=n("div",{class:"clear"},null,-1),D={class:"pagination"},L=["src"],R={key:1,class:"el-icon-plus avatar-uploader-icon"},q={class:"dialog-footer"},E={class:"customWidth"},j=["src"];var P=C(I,[["render",function(e,l,a,t,f,v){const _=i("el-button"),b=i("el-input"),y=i("el-table-column"),w=i("el-image"),x=i("el-table"),C=i("el-pagination"),I=i("el-form-item"),P=i("el-upload"),T=i("Ueditor"),$=i("el-form"),H=i("el-dialog"),A=o("permission");return d(),r("div",null,[n("div",U,[n("div",V,[n("div",k,[s((d(),c(_,{type:"primary",size:"small",icon:"el-icon-plus",onClick:l[0]||(l[0]=e=>t.handleEdit(0,null,!0,null))},{default:u((()=>[m("添加 ")])),_:1})),[[A,["road_movepic_add","park_movepic_add"]]]),s((d(),c(_,{type:"danger",size:"small",icon:"el-icon-delete",onClick:l[1]||(l[1]=e=>v.handleDeleteAll())},{default:u((()=>[m("批量删除 ")])),_:1})),[[A,["road_movepic_deleteAll","park_movepic_deleteAll"]]])]),n("div",S,[p(b,{onKeyup:l[2]||(l[2]=g((e=>t.handleSearch()),["enter"])),size:"small",modelValue:t.query.title,"onUpdate:modelValue":l[3]||(l[3]=e=>t.query.title=e),placeholder:"标题",class:"handle-input mr10"},null,8,["modelValue"]),p(_,{size:"small",type:"primary",icon:"el-icon-search",onClick:t.handleSearch},{default:u((()=>[m("查询 ")])),_:1},8,["onClick"])]),z]),p(x,{data:t.tableData,border:"",class:"table",ref:"multipleTable","max-height":f.tableH,"header-cell-class-name":"table-header",onSelectionChange:v.handleSelectionChange},{default:u((()=>[p(y,{type:"selection",width:"55",align:"center"}),p(y,{label:"序号",width:"55",align:"center"},{default:u((e=>[m(h((t.query.pageIndex-1)*t.query.pageSize+e.$index+1),1)])),_:1}),p(y,{label:"图片(查看大图)",width:"200",align:"center"},{default:u((e=>[p(w,{class:"table-td-thumb",src:v.imgurl(e.row.pic_url),"hide-on-click-modal":"true","preview-teleported":"true","preview-src-list":[v.imgurl(e.row.pic_url)]},null,8,["src","preview-src-list"])])),_:1}),p(y,{prop:"title",label:"标题",align:"center"}),p(y,{prop:"sort",width:"100",label:"排序",align:"center"}),p(y,{label:"创建时间",prop:"create_time",width:"180",align:"center"}),p(y,{prop:"update_time",label:"更新时间",align:"center",width:"180"}),p(y,{label:"操作",width:"220",align:"center"},{default:u((e=>[s((d(),c(_,{size:"mini",type:"text",icon:"el-icon-edit",onClick:l=>t.handleEdit(e.$index,e.row,!1)},{default:u((()=>[m("编辑 ")])),_:2},1032,["onClick"])),[[A,["park_movepic_edit","road_movepic_edit"]]]),s((d(),c(_,{size:"mini",type:"text",icon:"el-icon-delete",class:"red",onClick:l=>t.handleDelete(e.$index,e.row)},{default:u((()=>[m("删除 ")])),_:2},1032,["onClick"])),[[A,["road_movepic_delete","park_movepic_delete"]]])])),_:1})])),_:1},8,["data","max-height","onSelectionChange"]),n("div",D,[p(C,{background:"",layout:"total, prev, pager, next","current-page":t.query.pageIndex,"page-size":t.query.pageSize,total:t.pageTotal,onCurrentChange:t.handlePageChange},null,8,["current-page","page-size","total","onCurrentChange"])])]),p(H,{title:t.dialogT,modelValue:t.editVisible,"onUpdate:modelValue":l[8]||(l[8]=e=>t.editVisible=e),width:"35%",top:"2vh"},{footer:u((()=>[n("span",q,[p(_,{onClick:l[6]||(l[6]=e=>t.editVisible=!1)},{default:u((()=>[m("取 消")])),_:1}),p(_,{type:"primary",onClick:l[7]||(l[7]=e=>v.saveEdit("formId"))},{default:u((()=>[m("确 定")])),_:1})])])),default:u((()=>[p($,{"label-width":"70px",size:"small",rules:f.formRules,ref:"formId","label-position":"top",model:t.form},{default:u((()=>[p(I,{label:"标题",prop:"title"},{default:u((()=>[p(b,{modelValue:t.form.title,"onUpdate:modelValue":l[4]||(l[4]=e=>t.form.title=e),placeholder:"请输入标题"},null,8,["modelValue"])])),_:1}),p(I,{label:"封面"},{default:u((()=>[p(P,{class:"avatar-uploader",action:f.uploadUrl,"show-file-list":!1,"on-preview":v.handlePictureCardPreview,"on-remove":v.handleRemove,"on-success":v.handleSuccess},{default:u((()=>[t.imageUrl?(d(),r("img",{key:0,src:t.imageUrl,class:"avatar"},null,8,L)):(d(),r("i",R))])),_:1},8,["action","on-preview","on-remove","on-success"])])),_:1}),p(I,{label:"排序",prop:"sort"},{default:u((()=>[p(b,{modelValue:t.form.sort,"onUpdate:modelValue":l[5]||(l[5]=e=>t.form.sort=e),placeholder:"请输入排序",oninput:"value=value.replace(/[^\\d]/g,'')"},null,8,["modelValue"])])),_:1}),p(I,{label:"详情"},{default:u((()=>[p(T,{onReady:v.editorReady,ref:"ue",value:t.form.content,ueditorConfig:t.uform.config},null,8,["onReady","value","ueditorConfig"])])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["title","modelValue"]),p(H,{modelValue:t.dialogVisible,"onUpdate:modelValue":l[9]||(l[9]=e=>t.dialogVisible=e)},{default:u((()=>[n("div",E,[n("img",{class:"imgWidth",src:t.dialogImageUrl,alt:""},null,8,j)])])),_:1},8,["modelValue"])])}]]);export{P as default};
