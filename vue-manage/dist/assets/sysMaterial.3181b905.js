import{f as e,b as l,q as a,L as t,r as i,M as d,o as s,h as o,i as n,w as r,c as u,l as c,m,k as f,I as p,t as h,p as g,s as _,x as y}from"./vendor.ac52fd94.js";import{d as v,a as b,e as V,s as x,b as I}from"./sysMaterial.ab658a9e.js";import{F as w}from"./file_url.ec979fed.js";import{_ as C}from"./index.1d57ac4a.js";const k={name:"sysMateriallist",components:{},data:()=>({tableH:0,uploadUrl:w.file_img_url,imgViewUrl:w.file_hx_img_url,formRules:{title:[{required:!0,message:"必填项",trigger:"blur"}]}}),setup(){const i=e({title:"",pageIndex:1,pageSize:15}),d=l([]),s=l(0),o=()=>{x(i).then((e=>{console.log(e),d.value=e.data.list,s.value=e.data.total}))};o();let n=l("编辑");const r=l(!1),u=l(!1),c=l({type:"1",state:"1"}),m=l([]),f=l([]),p=l(""),h=l("");return{query:i,tableData:d,pageTotal:s,editVisible:r,form:c,fileIds:m,fileList2:f,imageId:h,imageUrl:p,dialogT:n,getData:o,handleSearch:()=>{i.pageIndex=1,o()},handlePageChange:e=>{i.pageIndex=e,o()},handleDelete:(l,i)=>{t.confirm("确定要删除吗？","提示",{type:"warning"}).then((()=>{let l=e({is_del:"1",id:i.id});V(l).then((e=>{console.log(e),a.success("删除成功")})).then((()=>{o()}))})).catch((()=>{}))},handleEdit:(l,a,t)=>{r.value=!0,c.value={type:"1",state:"1"},m.value=[],f.value=[],p.value="",h.value="",t?n.value="新增":(n.value="编辑",I(e({id:a.id})).then((e=>{c.value=e.data,""!=e.data.file_id&&null!=e.data.file_id?(m.value=e.data.file_id.split(","),h.value=e.data.file_id):(m.value=[],h.value=""),""!=e.data.fileList&&null!=e.data.fileList?(f.value=e.data.fileList,p.value=e.data.fileList[0].file_url):(f.value=[],p.value="")})))},multipleSelection:[],dialogImageUrl:"",dialogVisible:u,fileList:[]}},created(){let e=document.documentElement.clientHeight||document.body.clientHeight;this.tableH=e-308+"px"},methods:{handleSuccess(e,l,a){this.fileIds.push(e.id+""),this.imageId=e.id+"",l.id=e.id,this.imageUrl=URL.createObjectURL(l.raw)},handlePreview(e){},handleExceed(e,l){this.$message.warning("只能上传一个文件")},beforeAvatarUpload(e){if("1"==this.form.type){const l="image/jpeg"===e.type||"image/png"===e.type;return l||this.$message.error("上传图片只能是 JPG 和 PNG 格式!"),l}{const l="video/mp4"===e.type||"video/avi"===e.type;return l||this.$message.error("上传视频只能是 MP4 / AVI 格式!"),l}},handleRemove(l,t){let i=this.fileIds.indexOf(l.id+"");-1==i&&(i=this.fileIds.indexOf(l.id));let d=0;-1!=i&&v(e({id:l.id})).then((e=>{d=e.success})).then((()=>{0==d?(a.success("操作成功"),this.fileIds.splice(i,1)):-1==d&&a.error("操作失败!")}))},handlePictureCardPreview(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},imgurl:function(e){if(""!=e&&null!=e)return e},handleSelectionChange(e){this.selectedData=e},handleDeleteAll(){t.confirm("确定要删除吗？","提示",{type:"warning"}).then((()=>{var e=this,l=this.selectedData,t="";l?(l.forEach((function(e,l){t=t+e.id+","})),b({ids:t}).then((l=>{a.success("删除成功"),e.getData()}))):a.warning("请选择一条记录")})).catch((()=>{}))},saveEdit(e){let l=0,t=this;this.$refs[e].validate((e=>{e&&(t.form.fileList=[],t.fileIds.length>0?t.form.file_id=t.fileIds.join(","):t.form.file_id="",t.form.file_id=t.imageId,V(t.form).then((e=>{l=e.code})).then((()=>{0==l?(a.success("操作成功"),t.editVisible=!1,t.query.pageIndex=1,t.form.fileList=[],t.fileIds=[],t.imageId="",t.imageUrl="",t.getData()):-1==l&&a.error("操作失败!")})))}))}}},U={class:"container"},z={class:"handle-box"},S={class:"left-panel"},L={class:"right-panel"},M=(e=>(_("data-v-44e2e8cc"),e=e(),y(),e))((()=>n("div",{class:"clear"},null,-1))),D={key:0},q={key:1},E={class:"pagination"},P={class:"dialog-footer"},j={class:"customWidth"},A=["src"];var $=C(k,[["render",function(e,l,a,t,_,y){const v=i("el-button"),b=i("el-input"),V=i("el-table-column"),x=i("el-tag"),I=i("el-table"),w=i("el-pagination"),C=i("el-form-item"),k=i("el-radio"),$=i("el-radio-group"),R=i("el-upload"),H=i("el-form"),T=i("el-dialog"),O=d("permission");return s(),o("div",null,[n("div",U,[n("div",z,[n("div",S,[r((s(),u(v,{type:"primary",size:"small",icon:"el-icon-plus",onClick:l[0]||(l[0]=e=>t.handleEdit(0,null,!0,null))},{default:c((()=>[m("添加 ")])),_:1})),[[O,["park_sysMaterial_add","road_sysMaterial_add"]]]),r((s(),u(v,{type:"danger",size:"small",icon:"el-icon-delete",onClick:l[1]||(l[1]=e=>y.handleDeleteAll())},{default:c((()=>[m("批量删除 ")])),_:1})),[[O,["road_sysMaterial_deleteAll","park_sysMaterial_deleteAll"]]])]),n("div",L,[f(b,{onKeyup:l[2]||(l[2]=p((e=>t.handleSearch()),["enter"])),size:"small",modelValue:t.query.title,"onUpdate:modelValue":l[3]||(l[3]=e=>t.query.title=e),placeholder:"标题",class:"handle-input mr10"},null,8,["modelValue"]),f(v,{size:"small",type:"primary",icon:"el-icon-search",onClick:t.handleSearch},{default:c((()=>[m("查询 ")])),_:1},8,["onClick"])]),M]),f(I,{data:t.tableData,border:"",class:"table",ref:"multipleTable","max-height":_.tableH,"header-cell-class-name":"table-header",onSelectionChange:y.handleSelectionChange},{default:c((()=>[f(V,{type:"selection",width:"55",align:"center"}),f(V,{label:"序号",width:"55",align:"center"},{default:c((e=>[m(h((t.query.pageIndex-1)*t.query.pageSize+e.$index+1),1)])),_:1}),f(V,{prop:"title",label:"标题",align:"center"}),f(V,{width:"100",label:"类型",align:"center"},{default:c((e=>["1"==e.row.type?(s(),o("p",D,"图片")):g("",!0),"2"==e.row.type?(s(),o("p",q,"视频")):g("",!0)])),_:1}),f(V,{label:"启用",align:"center",width:"100"},{default:c((e=>["1"==e.row.state?(s(),u(x,{key:0,size:"small",type:"success"},{default:c((()=>[m("启用")])),_:1})):(s(),u(x,{key:1,size:"small",type:"danger"},{default:c((()=>[m("禁用")])),_:1}))])),_:1}),f(V,{label:"操作",width:"220",align:"center"},{default:c((e=>[r((s(),u(v,{size:"mini",type:"text",icon:"el-icon-edit",onClick:l=>t.handleEdit(e.$index,e.row,!1)},{default:c((()=>[m("编辑 ")])),_:2},1032,["onClick"])),[[O,["park_sysMaterial_edit","road_sysMaterial_edit"]]]),r((s(),u(v,{size:"mini",type:"text",icon:"el-icon-delete",class:"red",onClick:l=>t.handleDelete(e.$index,e.row)},{default:c((()=>[m("删除 ")])),_:2},1032,["onClick"])),[[O,["road_sysMaterial_delete","park_sysMaterial_delete"]]])])),_:1})])),_:1},8,["data","max-height","onSelectionChange"]),n("div",E,[f(w,{background:"",layout:"total, prev, pager, next","current-page":t.query.pageIndex,"page-size":t.query.pageSize,total:t.pageTotal,onCurrentChange:t.handlePageChange},null,8,["current-page","page-size","total","onCurrentChange"])])]),f(T,{title:t.dialogT,modelValue:t.editVisible,"onUpdate:modelValue":l[9]||(l[9]=e=>t.editVisible=e),width:"500px"},{footer:c((()=>[n("span",P,[f(v,{onClick:l[7]||(l[7]=e=>t.editVisible=!1)},{default:c((()=>[m("取 消")])),_:1}),f(v,{type:"primary",onClick:l[8]||(l[8]=e=>y.saveEdit("formId"))},{default:c((()=>[m("确 定")])),_:1})])])),default:c((()=>[f(H,{"label-width":"70px",size:"small",rules:_.formRules,ref:"formId",model:t.form},{default:c((()=>[f(C,{label:"标题",prop:"title"},{default:c((()=>[f(b,{modelValue:t.form.title,"onUpdate:modelValue":l[4]||(l[4]=e=>t.form.title=e),placeholder:"请输入标题"},null,8,["modelValue"])])),_:1}),f(C,{label:"类型"},{default:c((()=>[f($,{modelValue:t.form.type,"onUpdate:modelValue":l[5]||(l[5]=e=>t.form.type=e)},{default:c((()=>[f(k,{label:"1"},{default:c((()=>[m("图片")])),_:1}),f(k,{label:"2"},{default:c((()=>[m("视频")])),_:1})])),_:1},8,["modelValue"])])),_:1}),f(C,{label:"文件"},{default:c((()=>[f(R,{class:"upload-demo",action:_.uploadUrl,"on-preview":y.handlePreview,"on-remove":y.handleRemove,limit:1,"on-exceed":y.handleExceed,"file-list":t.fileList2,"on-success":y.handleSuccess,"before-upload":y.beforeAvatarUpload},{default:c((()=>[f(v,{size:"small",type:"primary"},{default:c((()=>[m("点击上传")])),_:1})])),_:1},8,["action","on-preview","on-remove","on-exceed","file-list","on-success","before-upload"])])),_:1}),f(C,{label:"是否启用",prop:""},{default:c((()=>[f($,{modelValue:t.form.state,"onUpdate:modelValue":l[6]||(l[6]=e=>t.form.state=e)},{default:c((()=>[f(k,{label:"1"},{default:c((()=>[m("是")])),_:1}),f(k,{label:"0"},{default:c((()=>[m("否")])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["title","modelValue"]),f(T,{modelValue:t.dialogVisible,"onUpdate:modelValue":l[10]||(l[10]=e=>t.dialogVisible=e)},{default:c((()=>[n("div",j,[n("img",{class:"imgWidth",src:t.dialogImageUrl,alt:""},null,8,A)])])),_:1},8,["modelValue"])])}],["__scopeId","data-v-44e2e8cc"]]);export{$ as default};
