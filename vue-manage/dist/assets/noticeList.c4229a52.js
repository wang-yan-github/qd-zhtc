import{f as e,b as l,q as a,L as t,r as i,M as o,o as n,h as s,i as r,w as d,c,l as u,m,k as p,I as h,t as f}from"./vendor.ac52fd94.js";import{U as g}from"./UE.013b43f7.js";import{d as _,a as v,e as b,s as y,b as w}from"./sysResourceIndex.2c650a03.js";import{F as k}from"./file_url.ec979fed.js";import{_ as x}from"./index.1d57ac4a.js";const C={name:"noticeList",components:{Ueditor:g},data:()=>({tableH:0,uploadUrl:k.file_img_url,imgViewUrl:k.file_hx_img_url,formRules:{title:[{required:!0,message:"必填项",trigger:"blur"}]}}),setup(){const i=e({title:"",category:"4",pageIndex:1,pageSize:15}),o=l([]),n=l(0),s=()=>{y(i).then((e=>{console.log(e),o.value=e.data.list,n.value=e.data.total}))};s();let r=l("编辑");const d=l(!1),c=l(!1),u=l({}),m=l([]),p=l([]),h=l(""),f=l("");let g=e({config:{initialFrameHeight:300,initialFrameWidth:"100%"}});return{query:i,tableData:o,pageTotal:n,editVisible:d,form:u,uform:g,fileIds:m,fileList2:p,imageId:f,imageUrl:h,dialogT:r,getData:s,handleSearch:()=>{i.pageIndex=1,s()},handlePageChange:e=>{i.pageIndex=e,s()},handleDelete:(l,i)=>{t.confirm("确定要删除吗？","提示",{type:"warning"}).then((()=>{let l=e({is_del:"1",id:i.id});b(l).then((e=>{console.log(e),a.success("删除成功")})).then((()=>{s()}))})).catch((()=>{}))},handlePush:(l,i,o)=>{let n="确定要禁用吗？";"0"==o?(n="确定要推送吗？",o="1"):o="0",t.confirm(n,"提示",{type:"warning"}).then((()=>{let l=e({is_push:o,id:i.id});b(l).then((e=>{console.log(e),a.success("操作成功")})).then((()=>{s()}))})).catch((()=>{}))},handleEdit:(l,a,t)=>{d.value=!0,u.value={},m.value=[],p.value=[],h.value="",f.value="",t?r.value="新增":(r.value="编辑",w(e({id:a.id})).then((e=>{u.value=e.data,""!=e.data.picture_id&&null!=e.data.picture_id?(m.value=e.data.picture_id.split(","),f.value=e.data.picture_id):(m.value=[],f.value=""),""!=e.data.fileList&&null!=e.data.fileList?(p.value=e.data.fileList,h.value=e.data.fileList[0].file_url):(p.value=[],h.value="")})))},multipleSelection:[],dialogImageUrl:"",dialogVisible:c}},created(){let e=document.documentElement.clientHeight||document.body.clientHeight;this.tableH=e-308+"px"},methods:{handleSuccess(e,l,a){this.fileIds.push(e.id+""),this.imageId=e.id+"",l.id=e.id,this.imageUrl=URL.createObjectURL(l.raw),console.log("imageUrl",this.imageUrl),console.log(e,l,a)},handleRemove(l,t){console.log(l,t);let i=this.fileIds.indexOf(l.id+"");-1==i&&(i=this.fileIds.indexOf(l.id));let o=0;-1!=i&&_(e({id:l.id})).then((e=>{o=e.success})).then((()=>{0==o?(a.success("操作成功"),this.fileIds.splice(i,1)):-1==o&&a.error("操作失败!")}))},handlePictureCardPreview(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},imgurl:function(e){if(""!=e&&null!=e)return e},handleSelectionChange(e){this.selectedData=e},handleDeleteAll(){t.confirm("确定要删除吗？","提示",{type:"warning"}).then((()=>{var e=this,l=this.selectedData;console.log(l);var t="";l?(l.forEach((function(e,l){t=t+e.id+","})),v({ids:t}).then((l=>{a.success("删除成功"),e.getData()}))):a.warning("请选择一条记录")})).catch((()=>{}))},editorReady(e){this.$refs.ue.setText(this.form.content)},saveEdit(e){let l=0,t=this;this.$refs[e].validate((e=>{e&&(t.form.content=this.$refs.ue.getUEContent(),""==t.form.content||null==t.form.content||null==t.form.content?a.error("请填写内容!"):(t.form.category="4",t.form.fileList=[],t.fileIds.length>0?t.form.picture_id=t.fileIds.join(","):t.form.picture_id="",t.form.picture_id=t.imageId,b(t.form).then((e=>{l=e.code})).then((()=>{0==l?(a.success("操作成功"),t.editVisible=!1,t.query.pageIndex=1,t.form.fileList=[],t.fileIds=[],t.imageId="",t.imageUrl="",this.$refs.ue.setText(""),t.getData()):-1==l&&a.error("操作失败!")}))))}))}}},V={class:"container"},U={class:"handle-box"},I={class:"left-panel"},z={class:"right-panel"},S=r("div",{class:"clear"},null,-1),D={class:"pagination"},L=["src"],R={key:1,class:"el-icon-plus avatar-uploader-icon"},E={class:"dialog-footer"},P={class:"customWidth"},$=["src"];var q=x(C,[["render",function(e,l,a,t,g,_){const v=i("el-button"),b=i("el-input"),y=i("el-table-column"),w=i("el-image"),k=i("el-tag"),x=i("el-table"),C=i("el-pagination"),q=i("el-form-item"),j=i("el-upload"),T=i("Ueditor"),H=i("el-form"),A=i("el-dialog"),F=o("permission");return n(),s("div",null,[r("div",V,[r("div",U,[r("div",I,[d((n(),c(v,{type:"primary",size:"small",icon:"el-icon-plus",onClick:l[0]||(l[0]=e=>t.handleEdit(0,null,!0,null))},{default:u((()=>[m("添加 ")])),_:1})),[[F,["road_notice_add","park_notice_add"]]]),d((n(),c(v,{type:"danger",size:"small",icon:"el-icon-delete",onClick:l[1]||(l[1]=e=>_.handleDeleteAll())},{default:u((()=>[m("批量删除 ")])),_:1})),[[F,["road_notice_deleteAll","park_notice_deleteAll"]]])]),r("div",z,[p(b,{onKeyup:l[2]||(l[2]=h((e=>t.handleSearch()),["enter"])),size:"small",modelValue:t.query.title,"onUpdate:modelValue":l[3]||(l[3]=e=>t.query.title=e),placeholder:"标题",class:"handle-input mr10"},null,8,["modelValue"]),p(v,{size:"small",type:"primary",icon:"el-icon-search",onClick:t.handleSearch},{default:u((()=>[m("查询 ")])),_:1},8,["onClick"])]),S]),p(x,{data:t.tableData,border:"",class:"table","max-height":g.tableH,ref:"multipleTable","header-cell-class-name":"table-header",onSelectionChange:_.handleSelectionChange},{default:u((()=>[p(y,{type:"selection",width:"55",align:"center"}),p(y,{label:"序号",width:"55",align:"center"},{default:u((e=>[m(f(e.$index+1),1)])),_:1}),p(y,{label:"图片(查看大图)",width:"200",align:"center"},{default:u((e=>[p(w,{class:"table-td-thumb",src:_.imgurl(e.row.pic_url),"hide-on-click-modal":"true","preview-teleported":"true","preview-src-list":[_.imgurl(e.row.pic_url)]},null,8,["src","preview-src-list"])])),_:1}),p(y,{prop:"title",label:"标题",align:"center"}),p(y,{label:"创建时间",prop:"create_time",width:"180",align:"center"}),p(y,{prop:"update_time",label:"更新时间",align:"center",width:"180"}),p(y,{label:"推送",align:"center",width:"100"},{default:u((e=>["0"==e.row.is_push?(n(),c(k,{key:0,size:"small",type:"1"===e.row.is_push?"success":"0"===e.row.is_push?"danger":""},{default:u((()=>[m("已禁用 ")])),_:2},1032,["type"])):(n(),c(k,{key:1,size:"small",type:"1"===e.row.is_push?"success":"0"===e.row.is_push?"danger":""},{default:u((()=>[m("已推送 ")])),_:2},1032,["type"]))])),_:1}),p(y,{label:"操作",width:"220",align:"center"},{default:u((e=>[d((n(),c(v,{size:"mini",type:"text",icon:"el-icon-edit",onClick:l=>t.handleEdit(e.$index,e.row,!1)},{default:u((()=>[m("编辑 ")])),_:2},1032,["onClick"])),[[F,["road_notice_edit","park_notice_edit"]]]),"0"==e.row.is_push?d((n(),c(v,{key:0,size:"mini",type:"text",icon:"el-icon-document-checked",onClick:l=>t.handlePush(e.$index,e.row,e.row.is_push)},{default:u((()=>[m("推送 ")])),_:2},1032,["onClick"])),[[F,["road_notice_ts","park_notice_ts"]]]):d((n(),c(v,{key:1,size:"mini",type:"text",icon:"el-icon-circle-close",class:"red",onClick:l=>t.handlePush(e.$index,e.row,e.row.is_push)},{default:u((()=>[m("禁用 ")])),_:2},1032,["onClick"])),[[F,["road_notice_status","park_notice_status"]]]),d((n(),c(v,{size:"mini",type:"text",icon:"el-icon-delete",class:"red",onClick:l=>t.handleDelete(e.$index,e.row)},{default:u((()=>[m("删除 ")])),_:2},1032,["onClick"])),[[F,["road_notice_delete","park_notice_delete"]]])])),_:1})])),_:1},8,["data","max-height","onSelectionChange"]),r("div",D,[p(C,{background:"",layout:"total, prev, pager, next","current-page":t.query.pageIndex,"page-size":t.query.pageSize,total:t.pageTotal,onCurrentChange:t.handlePageChange},null,8,["current-page","page-size","total","onCurrentChange"])])]),p(A,{title:t.dialogT,modelValue:t.editVisible,"onUpdate:modelValue":l[9]||(l[9]=e=>t.editVisible=e),width:"35%",top:"2vh"},{footer:u((()=>[r("span",E,[p(v,{onClick:l[7]||(l[7]=e=>t.editVisible=!1)},{default:u((()=>[m("取 消")])),_:1}),p(v,{type:"primary",onClick:l[8]||(l[8]=e=>_.saveEdit("formId"))},{default:u((()=>[m("确 定")])),_:1})])])),default:u((()=>[p(H,{"label-width":"70px",size:"small",rules:g.formRules,ref:"formId","label-position":"top",model:t.form},{default:u((()=>[p(q,{label:"标题",prop:"title"},{default:u((()=>[p(b,{modelValue:t.form.title,"onUpdate:modelValue":l[4]||(l[4]=e=>t.form.title=e),placeholder:"请输入标题"},null,8,["modelValue"])])),_:1}),p(q,{label:"封面"},{default:u((()=>[p(j,{class:"avatar-uploader",action:g.uploadUrl,"show-file-list":!1,"on-preview":_.handlePictureCardPreview,"on-remove":_.handleRemove,"on-success":_.handleSuccess},{default:u((()=>[t.imageUrl?(n(),s("img",{key:0,src:t.imageUrl,class:"avatar"},null,8,L)):(n(),s("i",R))])),_:1},8,["action","on-preview","on-remove","on-success"])])),_:1}),p(q,{label:"摘要",prop:"resource_abstract"},{default:u((()=>[p(b,{type:"textarea",rows:4,placeholder:"请输入摘要",modelValue:t.form.resource_abstract,"onUpdate:modelValue":l[5]||(l[5]=e=>t.form.resource_abstract=e)},null,8,["modelValue"])])),_:1}),p(q,{label:"排序",prop:"sort"},{default:u((()=>[p(b,{modelValue:t.form.sort,"onUpdate:modelValue":l[6]||(l[6]=e=>t.form.sort=e),placeholder:"请输入排序",oninput:"value=value.replace(/[^\\d]/g,'')"},null,8,["modelValue"])])),_:1}),p(q,{label:"详情"},{default:u((()=>[p(T,{onReady:_.editorReady,ref:"ue",value:t.form.content,ueditorConfig:t.uform.config},null,8,["onReady","value","ueditorConfig"])])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["title","modelValue"]),p(A,{modelValue:t.dialogVisible,"onUpdate:modelValue":l[10]||(l[10]=e=>t.dialogVisible=e)},{default:u((()=>[r("div",P,[r("img",{class:"imgWidth",src:t.dialogImageUrl,alt:""},null,8,$)])])),_:1},8,["modelValue"])])}]]);export{q as default};
