import{f as e,b as l,q as a,L as t,a as i,r as o,M as s,o as n,h as r,i as d,w as p,c as u,l as c,m,k as g,I as h}from"./vendor.ac52fd94.js";import{U as f}from"./UE.013b43f7.js";import{I as _,_ as v}from"./index.1d57ac4a.js";import{F as b}from"./file_url.ec979fed.js";const y=e=>_({url:"/sysPosappManager/del",method:"post",params:e});const w={name:"sysPosappManagerList",components:{Ueditor:f},data:()=>({tableH:0,imgViewUrl:b.file_hx_img_url,uploadUrl:b.file_upload,formRules:{version:[{required:!0,message:"必填项",trigger:"blur"}]}}),setup(){const i=e({title:"",version:"",category:"4",pageIndex:1,pageSize:15}),o=l([]),s=l([]),n=l(0),r=l(!1),d=l(!1),p=l({}),u=l([]),c=l([]);let m=l("编辑");const g=()=>{(e=>_({url:"/sysPosappManager/getPage",method:"post",params:e}))(i).then((e=>{s.value=e.data.list,n.value=e.data.total}))};g();return{query:i,tableData:s,uploadFileApk:o,pageTotal:n,editVisible:r,form:p,fileIds:u,fileList2:c,dialogT:m,getData:g,handleSearch:()=>{i.pageIndex=1,g()},handlePageChange:e=>{i.pageIndex=e,g()},handleDelete:(l,i)=>{t.confirm("确定要删除吗？","提示",{type:"warning"}).then((()=>{let l=e({is_del:"1",id:i.id});y(l).then((e=>{console.log(e),a.success("删除成功")})).then((()=>{g()}))})).catch((()=>{}))},handlePush:(l,i,o)=>{let s="确定要禁用吗？";"0"==o?(s="确定要启用吗？",o="1"):o="0",t.confirm(s,"提示",{type:"warning"}).then((()=>{(e=>_({url:"/sysPosappManager/enableDisable",method:"post",params:e}))(e({is_use:o,id:i.id})).then((e=>{console.log(e),a.success("操作成功")})).then((()=>{g()}))})).catch((()=>{}))},handleEdit:(l,a,t)=>{r.value=!0,0!=document.getElementsByClassName("el-upload-list__item-name").length&&o.value.clearFiles(),p.value={},u.value=[],c.value=[],t?m.value="新增":(m.value="编辑",(e=>_({url:"/sysPosappManager/getById",method:"post",params:e}))(e({id:a.id})).then((e=>{p.value=e.data,""!=e.data.picture_id&&null!=e.data.picture_id?u.value=e.data.picture_id.split(","):u.value=[],""!=e.data.fileList&&null!=e.data.fileList?c.value=e.data.fileList:c.value=[]})))},multipleSelection:[],dialogImageUrl:"",dialogVisible:d}},created(){let e=document.documentElement.clientHeight||document.body.clientHeight;this.tableH=e-308+"px"},methods:{handleSuccess(e,l,a){this.fileIds.push(e.id+""),l.id=e.id,console.log(e,l,a)},handlePreview(e){console.log(e)},handleRemove(l,t){console.log(l,t);let i=this.fileIds.indexOf(l.id+"");-1==i&&(i=this.fileIds.indexOf(l.id));let o=0;var s;-1!=i&&(s=e({id:l.id}),_({url:"/fileManage/delImgFile.json",method:"post",params:s})).then((e=>{o=e.success})).then((()=>{0==o?(a.success("操作成功"),this.fileIds.splice(i,1)):-1==o&&a.error("操作失败!")}))},handlePictureCardPreview(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},imgurl:function(e){if(""!=e&&null!=e)return this.imgViewUrl+e},handleSelectionChange(e){this.selectedData=e},handleDeleteAll(){t.confirm("确定要删除吗？","提示",{type:"warning"}).then((()=>{var e=this,l=this.selectedData;console.log(l);var t="";l?(l.forEach((function(e,l){t=t+e.id+","})),y({ids:t}).then((l=>{a.success("删除成功"),e.getData()}))):a.warning("请选择一条记录")})).catch((()=>{}))},onProgress(e,l,a){this.form.file_apk=l,console.info(l)},save(){var e=this,l=e.form.title,t=e.form.version,o=e.form.upgrade_content,s=e.form.file_apk;if(null!=l&&null!=l&&""!=l)if(null!=t&&null!=t&&""!=t)if(null!=s&&null!=s&&""!=s)if(null!=o&&null!=o&&""!=o){let a=new FormData;a.append("fileApk",s[0].raw),a.append("title",l),a.append("version",t),a.append("upgrade_content",o);let n={headers:{"Content-Type":"multipart/form-data",Authorization:localStorage.getItem("token_value")}};i.post(e.uploadUrl+"/sysPosappManager/save",a,n).then((l=>{0===l.data.code&&(self.ImgUrl=l.data.data),e.editVisible=!1,e.form={},e.getData()}))}else a.error("请输入升级内容");else a.error("请上传文件");else a.error("请输入版本号");else a.error("请输入标题")}}},k={class:"container"},V={class:"handle-box"},C={class:"left-panel"},x={class:"right-panel"},I=d("div",{class:"clear"},null,-1),P={class:"pagination"},U={class:"dialog-footer"},z={class:"customWidth"},D=["src"];var S=v(w,[["render",function(e,l,a,t,i,f){const _=o("el-button"),v=o("el-input"),b=o("el-table-column"),y=o("el-tag"),w=o("el-table"),S=o("el-pagination"),M=o("el-form-item"),q=o("el-upload"),j=o("el-form"),E=o("el-dialog"),F=s("permission");return n(),r("div",null,[d("div",k,[d("div",V,[d("div",C,[p((n(),u(_,{type:"primary",size:"small",icon:"el-icon-plus",onClick:l[0]||(l[0]=e=>t.handleEdit(0,null,!0,null))},{default:c((()=>[m("添加 ")])),_:1})),[[F,["park_posapp_add","road_posapp_add"]]])]),d("div",x,[g(v,{onKeyup:l[1]||(l[1]=h((e=>t.handleSearch()),["enter"])),size:"small",modelValue:t.query.version,"onUpdate:modelValue":l[2]||(l[2]=e=>t.query.version=e),placeholder:"请输入版本号",class:"handle-input mr10"},null,8,["modelValue"]),g(_,{size:"small",type:"primary",icon:"el-icon-search",onClick:t.handleSearch},{default:c((()=>[m("查询 ")])),_:1},8,["onClick"])]),I]),g(w,{data:t.tableData,border:"",class:"table",ref:"multipleTable","max-height":i.tableH,"header-cell-class-name":"table-header",onSelectionChange:f.handleSelectionChange},{default:c((()=>[g(b,{type:"index",label:"序号",width:"55",align:"center"}),g(b,{prop:"title",label:"标题",align:"center"}),g(b,{prop:"version",label:"版本号",align:"center"}),g(b,{prop:"upgrade_content",label:"升级内容",align:"center"}),g(b,{prop:"apk_url",label:"文件名",align:"center"}),g(b,{label:"创建时间",prop:"create_time",width:"180",align:"center"}),g(b,{prop:"update_time",label:"更新时间",align:"center",width:"180"}),g(b,{prop:"release_time",label:"发布时间",align:"center"}),g(b,{label:"是否启用",align:"center",width:"100"},{default:c((e=>["0"==e.row.is_use?(n(),u(y,{key:0,size:"small",type:"1"===e.row.is_use?"success":"0"===e.row.is_use?"danger":""},{default:c((()=>[m("未启用 ")])),_:2},1032,["type"])):(n(),u(y,{key:1,size:"small",type:"1"===e.row.is_use?"success":"0"===e.row.is_use?"danger":""},{default:c((()=>[m("已启用 ")])),_:2},1032,["type"]))])),_:1}),g(b,{label:"操作",width:"220",align:"center"},{default:c((e=>["0"==e.row.is_use?p((n(),u(_,{key:0,size:"mini",type:"text",icon:"el-icon-circle-check",onClick:l=>t.handlePush(e.$index,e.row,e.row.is_use)},{default:c((()=>[m("启用 ")])),_:2},1032,["onClick"])),[[F,["road_posapp_status","park_posapp_status"]]]):p((n(),u(_,{key:1,size:"mini",type:"text",icon:"el-icon-circle-close",class:"red",onClick:l=>t.handlePush(e.$index,e.row,e.row.is_use)},{default:c((()=>[m("禁用 ")])),_:2},1032,["onClick"])),[[F,["road_posapp_status","park_posapp_status"]]]),p((n(),u(_,{size:"mini",type:"text",icon:"el-icon-delete",class:"red",onClick:l=>t.handleDelete(e.$index,e.row)},{default:c((()=>[m("删除 ")])),_:2},1032,["onClick"])),[[F,["road_posapp_delete","park_posapp_delete"]]])])),_:1})])),_:1},8,["data","max-height","onSelectionChange"]),d("div",P,[g(S,{background:"",layout:"total, prev, pager, next","current-page":t.query.pageIndex,"page-size":t.query.pageSize,total:t.pageTotal,onCurrentChange:t.handlePageChange},null,8,["current-page","page-size","total","onCurrentChange"])])]),g(E,{title:t.dialogT,modelValue:t.editVisible,"onUpdate:modelValue":l[8]||(l[8]=e=>t.editVisible=e),width:"35%"},{footer:c((()=>[d("span",U,[g(_,{onClick:l[7]||(l[7]=e=>t.editVisible=!1)},{default:c((()=>[m("取 消")])),_:1}),g(_,{type:"primary",onClick:f.save},{default:c((()=>[m("确 定")])),_:1},8,["onClick"])])])),default:c((()=>[g(j,{"label-width":"70px",size:"small",rules:i.formRules,ref:"formId",model:t.form},{default:c((()=>[g(M,{label:"标题",prop:"title"},{default:c((()=>[g(v,{modelValue:t.form.title,"onUpdate:modelValue":l[3]||(l[3]=e=>t.form.title=e),placeholder:"请输入标题"},null,8,["modelValue"])])),_:1}),g(M,{label:"版本号",prop:"title"},{default:c((()=>[g(v,{modelValue:t.form.version,"onUpdate:modelValue":l[4]||(l[4]=e=>t.form.version=e),placeholder:"请输入版本号"},null,8,["modelValue"])])),_:1}),g(M,{label:"文件上传"},{default:c((()=>[g(q,{class:"upload-demo",ref:"uploadFileApk",action:"https://jsonplaceholder.typicode.com/posts/","on-preview":f.handlePreview,"on-remove":f.handleRemove,"on-change":f.onProgress,modelValue:t.form.file_apk,"onUpdate:modelValue":l[5]||(l[5]=e=>t.form.file_apk=e),limit:1,"auto-upload":!1},{default:c((()=>[g(_,{slot:"trigger",size:"small",type:"primary"},{default:c((()=>[m("选取文件")])),_:1})])),_:1},8,["on-preview","on-remove","on-change","modelValue"])])),_:1}),g(M,{label:"升级内容",prop:"upgrade_content"},{default:c((()=>[g(v,{type:"textarea",rows:4,placeholder:"请输入升级内容",modelValue:t.form.upgrade_content,"onUpdate:modelValue":l[6]||(l[6]=e=>t.form.upgrade_content=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["title","modelValue"]),g(E,{modelValue:t.dialogVisible,"onUpdate:modelValue":l[9]||(l[9]=e=>t.dialogVisible=e)},{default:c((()=>[d("div",z,[d("img",{class:"imgWidth",src:t.dialogImageUrl,alt:""},null,8,D)])])),_:1},8,["modelValue"])])}]]);export{S as default};
