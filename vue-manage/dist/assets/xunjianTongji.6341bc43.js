import{f as e,b as a,r as t,o as l,h as r,i as n,m as o,t as d,k as s,l as i,F as u,j as c,c as g}from"./vendor.ac52fd94.js";import{_ as m,aa as p,a5 as h,a6 as b,U as I,ab as f}from"./index.1d57ac4a.js";const y={name:"xunjianTongji",data:()=>({tableH:0}),setup(){const t=e({startTime:"",endTime:"",areaId:"",streetId:"",roadId:"",pageIndex:1,pageSize:18}),l=a([]),r=a(0);let n=e({time:"",areaId:"",streetId:"",roadId:"",areas:[],streets:[],roads:[]});(()=>{var e=new Date,a=e.getMonth(),l=e.getFullYear(),r=new Date(l,a,1),o=new Date(l,a+1,0);n.time=[r,o];var d=r.getDate(),s=r.getMonth()+1;s<10&&(s="0"+s),d<10&&(d="0"+d),t.startTime=r.getFullYear().toString()+"-"+s.toString()+"-"+d.toString()})();var o,d,s,i,u,c;o=new Date,d=o.getMonth(),s=o.getFullYear(),i=new Date(s,d+1,0),u=i.getDate(),(c=i.getMonth()+1)<10&&(c="0"+c),u<10&&(u="0"+u),t.endTime=i.getFullYear().toString()+"-"+c.toString()+"-"+u.toString();const g=()=>{p(t).then((e=>{l.value=e.data.list,r.value=e.data.page.total}))};g();const m=e({}),y=()=>{h(m).then((e=>{n.areas=e.data}))};y();let C=e({areaId:t.areaId});const v=e({streetId:t.streetId}),x=e=>`${e.getFullYear()}-${e.getMonth()+1>=10?e.getMonth()+1:"0"+(e.getMonth()+1)}-${e.getDate()>=10?e.getDate():"0"+e.getDate()}`;return{query:t,tableData:l,form:n,pageTotal:r,queryArea:m,queryStreet:C,queryRoad:v,getArea:y,getStreet:()=>{""==t.areaId?(n.streets=[],n.roads=[],t.streetId="",t.roadId=""):(C.areaId=t.areaId,t.roadId="",t.streetId="",n.roads=[],b(C).then((e=>{n.streets=e.data})))},getQueryDate:()=>{null==n.time||[]==n.time||""==n.time?(t.startTime="",t.endTime=""):(t.startTime=x(n.time[0]),t.endTime=x(n.time[1]))},getRoad:()=>{""==t.streetId?(n.roads=[],t.roadId=""):(n.roads=[],t.roadId="",v.streetId=t.streetId,I(v).then((e=>{n.roads=e.data})))},handleSearch:()=>{t.pageIndex=1,g()},handlePageChange:e=>{t.pageIndex=e,g()},exportExcel:()=>{f(t).then((e=>{const a=window.URL.createObjectURL(new Blob([e])),t=document.createElement("a");t.href=a,t.setAttribute("download","导出巡检统计报表.xls"),document.body.appendChild(t),t.click()}))}}},methods:{},created(){let e=document.documentElement.clientHeight||document.body.clientHeight;this.tableH=e-308+"px"}},C={class:"container"},v={class:"top-panel"},x=n("span",{class:"mar5 color999"},null,-1),S=n("span",{class:"mar5 color999"},null,-1),_={class:"pagination"};var D=m(y,[["render",function(e,a,m,p,h,b){const I=t("el-date-picker"),f=t("el-form-item"),y=t("el-option"),D=t("el-select"),w=t("el-button"),k=t("el-form"),q=t("el-table-column"),T=t("el-table"),V=t("el-pagination");return l(),r("div",null,[n("div",C,[n("div",v,[o(d(p.form.date1)+" ",1),s(k,{inline:"",size:"small"},{default:i((()=>[s(f,{label:"时间"},{default:i((()=>[s(I,{size:"small",modelValue:p.form.time,"onUpdate:modelValue":a[0]||(a[0]=e=>p.form.time=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",class:"datepicker",onChange:p.getQueryDate},null,8,["modelValue","onChange"])])),_:1}),s(f,{label:"选择层级"},{default:i((()=>[s(D,{clearable:"",modelValue:p.query.areaId,"onUpdate:modelValue":a[1]||(a[1]=e=>p.query.areaId=e),filterable:"",placeholder:"所有区域",class:"w100",onChange:p.getStreet},{default:i((()=>[(l(!0),r(u,null,c(p.form.areas,(e=>(l(),g(y,{key:e.id,label:e.area_name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"]),x,s(D,{clearable:"",modelValue:p.query.streetId,"onUpdate:modelValue":a[2]||(a[2]=e=>p.query.streetId=e),filterable:"",placeholder:"所有街道",class:"w100",onChange:p.getRoad},{default:i((()=>[(l(!0),r(u,null,c(p.form.streets,(e=>(l(),g(y,{key:e.id,label:e.street_name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"]),S,s(D,{clearable:"",modelValue:p.query.roadId,"onUpdate:modelValue":a[3]||(a[3]=e=>p.query.roadId=e),filterable:"",placeholder:"所有路内",class:"w100"},{default:i((()=>[(l(!0),r(u,null,c(p.form.roads,(e=>(l(),g(y,{key:e.id,label:e.road_name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),s(f,null,{default:i((()=>[s(w,{size:"small",type:"primary",icon:"el-icon-search",onClick:p.handleSearch},{default:i((()=>[o("查询")])),_:1},8,["onClick"])])),_:1}),s(f,null,{default:i((()=>[s(w,{size:"small",type:"success",icon:"el-icon-upload2",onClick:p.exportExcel},{default:i((()=>[o("导出")])),_:1},8,["onClick"])])),_:1})])),_:1})]),s(T,{data:p.tableData,border:"",class:"table",ref:"multipleTable","max-height":h.tableH,"header-cell-class-name":"table-header",onSelectionChange:e.handleSelectionChange},{default:i((()=>[s(q,{type:"index",label:"序号",width:"55",align:"center"}),s(q,{prop:"jobNo",label:"巡检工号",align:"center"}),s(q,{prop:"name",label:"巡检姓名",align:"center"}),s(q,{prop:"roadCount",label:"路内数量",align:"center"}),s(q,{prop:"deviceCount",label:"泊位数量",align:"center"}),s(q,{prop:"orderCount",label:"创建订单数",align:"center"}),s(q,{prop:"cash",label:"现金收入",align:"center"})])),_:1},8,["data","max-height","onSelectionChange"]),n("div",_,[s(V,{background:"",layout:"total, prev, pager, next","current-page":p.query.pageIndex,"page-size":p.query.pageSize,total:p.pageTotal,onCurrentChange:p.handlePageChange},null,8,["current-page","page-size","total","onCurrentChange"])])])])}]]);export{D as default};
